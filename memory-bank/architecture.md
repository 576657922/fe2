# é¡¹ç›®æ¶æ„ä¸æ–‡ä»¶è¯´æ˜ (Architecture & File Structure)

## å½“å‰å®ç°è¿›åº¦

### âœ… å·²å®ç°çš„å®Œæ•´åŸºç¡€è®¾æ–½ï¼ˆæ­¥éª¤ 1.1-1.10 åŠ 2.1-2.2 å®Œæˆ - 15/47 æ­¥éª¤ï¼‰

#### å‰ç«¯æ¡†æ¶å’Œå·¥å…·é“¾
- âœ… **Next.js 14** - å…¨æ ˆ React æ¡†æ¶ï¼Œæ”¯æŒ App Routerã€API Routesã€Server Components
- âœ… **TypeScript 5** - å…¨é“¾è·¯ç±»å‹å®‰å…¨ï¼Œç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥
- âœ… **Tailwind CSS 3** - åŸå­åŒ– CSSï¼Œå¿«é€Ÿæ„å»ºå“åº”å¼ç•Œé¢
- âœ… **shadcn/ui** - 6 ä¸ªåŸºç¡€ç»„ä»¶åº“ï¼ˆButton, Card, Input, Label, Progress, AlertDialogï¼‰

#### çŠ¶æ€ç®¡ç†å’Œæ•°æ®å¤„ç†
- âœ… **Zustand 5** - è½»é‡çº§çŠ¶æ€ç®¡ç†åº“ï¼Œç”¨äºç•ªèŒ„é’Ÿå’Œåšé¢˜çŠ¶æ€
- âœ… **Supabase Client** - PostgreSQL + Auth + Realtime çš„å®Œæ•´è§£å†³æ–¹æ¡ˆ
- âœ… **TypeScript ç±»å‹** - å®Œæ•´çš„æ•°æ®ç±»å‹å®šä¹‰ï¼ˆProfile, Question, UserProgress, QuestionAttempt, Bookmark, FocusSessionï¼‰

#### åŠ¨ç”»å’Œæ•°æ®å¯è§†åŒ–
- âœ… **Framer Motion** - é«˜æ€§èƒ½ React åŠ¨ç”»åº“ï¼Œç”¨äºå‡çº§æç¤ºã€è¿‡æ¸¡åŠ¨ç”»
- âœ… **Recharts** - å£°æ˜å¼ React å›¾è¡¨åº“ï¼Œç”¨äºç»Ÿè®¡æ•°æ®å¯è§†åŒ–
- âœ… **Lucide React** - 1000+ ç²¾ç¾å›¾æ ‡åº“

#### æ ¸å¿ƒé…ç½®æ–‡ä»¶
- âœ… `.env.local` - Supabase ç¯å¢ƒå˜é‡é…ç½®ï¼ˆNEXT_PUBLIC_SUPABASE_URL, NEXT_PUBLIC_SUPABASE_ANON_KEYï¼‰
- âœ… `lib/supabase.ts` - Supabase å®¢æˆ·ç«¯å•ä¾‹æ¨¡å¼åˆå§‹åŒ–
- âœ… `lib/types.ts` - å…¨å±€ TypeScript ç±»å‹å®šä¹‰
- âœ… `lib/utils.ts` - æ ·å¼åˆå¹¶å·¥å…·ï¼ˆcnï¼‰å’Œé€šç”¨å·¥å…·å‡½æ•°
- âœ… `components.json` - shadcn/ui é…ç½®æ–‡ä»¶

#### æ•°æ®åº“åŸºç¡€è®¾æ–½
- âœ… **Supabase PostgreSQL** - 6 ä¸ªæ ¸å¿ƒä¸šåŠ¡è¡¨
- âœ… **Row Level Security (RLS)** - æ‰€æœ‰ç”¨æˆ·è¡¨å¯ç”¨è¡Œçº§å®‰å…¨
- âœ… **æ•°æ®åº“ç´¢å¼•** - ä¸ºæŸ¥è¯¢ä¼˜åŒ–åˆ›å»ºäº†å¤åˆç´¢å¼•å’Œå•åˆ—ç´¢å¼•
- âœ… **è®¤è¯ç³»ç»Ÿ** - Email + GitHub OAuth åŒé‡è®¤è¯é…ç½®å®Œæˆ

---

## é¡¹ç›®æ ¹ç›®å½•æ–‡ä»¶è¯´æ˜

### æ–‡æ¡£æ–‡ä»¶ï¼ˆmemory-bank æ–‡ä»¶å¤¹å†…ï¼‰

#### 1. `design.md`
**ç”¨é€”**ï¼šäº§å“éœ€æ±‚ä¸åŠŸèƒ½è®¾è®¡æ–‡æ¡£
**å†…å®¹**ï¼š
- äº§å“å®šä½ä¸æ ¸å¿ƒç›®æ ‡
- ç”¨æˆ·ç”»åƒä¸ä½¿ç”¨åœºæ™¯
- åŠŸèƒ½éœ€æ±‚è¯¦ç»†è¯´æ˜ï¼ˆé¢˜åº“ã€åšé¢˜æ¨¡å¼ã€é”™é¢˜æœ¬ã€ç•ªèŒ„é’Ÿã€æ¸¸æˆåŒ–ç­‰ï¼‰
- ç”¨æˆ·æµç¨‹ç¤ºä¾‹
- MVP åŠŸèƒ½æ¸…å•

**ä½¿ç”¨åœºæ™¯**ï¼š
- å‚è€ƒäº§å“åŠŸèƒ½éœ€æ±‚æ—¶æŸ¥é˜…
- ä¸äº§å“ç»ç†è®¨è®ºåŠŸèƒ½æ—¶å‚è€ƒ
- ç¡®å®š MVP èŒƒå›´æ—¶æŸ¥çœ‹

---

#### 2. `tech-stack.md`
**ç”¨é€”**ï¼šæŠ€æœ¯é€‰å‹æ–¹æ¡ˆä¸æ¶æ„è®¾è®¡æ–‡æ¡£
**å†…å®¹**ï¼š
- æ ¸å¿ƒæŠ€æœ¯æ ˆé€‰æ‹©ï¼ˆNext.js, TypeScript, Supabase ç­‰ï¼‰
- é€‰å‹ç†ç”±å’Œè¯¦ç»†è¯´æ˜
- æ•°æ®åº“ Schema è®¾è®¡
- å…³é”®åŠŸèƒ½çš„æŠ€æœ¯å®ç°ç­–ç•¥
- é¡¹ç›®ç›®å½•ç»“æ„å»ºè®®
- å¼€å‘è·¯çº¿å›¾å’Œä¾èµ–åŒ…æ¸…å•

**ä½¿ç”¨åœºæ™¯**ï¼š
- å¼€å‘å‰ç†è§£æŠ€æœ¯æ¶æ„
- éœ€è¦æŸ¥è¯¢æŸä¸ªæŠ€æœ¯åº“çš„ç”¨æ³•æ—¶å‚è€ƒ
- æ•°æ®åº“è®¾è®¡å‚è€ƒ
- å›é¡¾æŠ€æœ¯å†³ç­–æ—¶æŸ¥é˜…

---

#### 3. `implementation-plan.md`
**ç”¨é€”**ï¼šè¯¦ç»†çš„åˆ†æ­¥å®æ–½è®¡åˆ’
**å†…å®¹**ï¼š
- 47 ä¸ªå…·ä½“çš„å®æ–½æ­¥éª¤ï¼Œåˆ†ä¸º 4 ä¸ªé˜¶æ®µ
- æ¯æ­¥åŒ…å«ï¼šç›®æ ‡ã€å…·ä½“æŒ‡ä»¤ã€éªŒè¯æµ‹è¯•
- é˜¶æ®µåˆ’åˆ†ï¼šåŸºç¡€è®¾æ–½ã€é¢˜åº“ä¸åšé¢˜ã€é”™é¢˜æœ¬ã€ç•ªèŒ„é’Ÿ
- æ•´ä½“éªŒæ”¶æ ‡å‡†
- ä¸‹ä¸€æ­¥è®¡åˆ’å’Œå¸¸è§é—®é¢˜

**ä½¿ç”¨åœºæ™¯**ï¼š
- å¼€å‘çš„ä¸»è¦å‚è€ƒæ–‡æ¡£
- é€æ­¥æ‰§è¡Œå„ä¸ªæ­¥éª¤æ—¶æŸ¥é˜…
- æ£€æŸ¥æŸä¸ªåŠŸèƒ½å¦‚ä½•å®ç°æ—¶å‚è€ƒ
- éªŒè¯åŠŸèƒ½å®Œæˆæƒ…å†µæ—¶ä½¿ç”¨

---

#### 4. `progress.md`
**ç”¨é€”**ï¼šé¡¹ç›®è¿›åº¦è·Ÿè¸ªæ–‡æ¡£
**å†…å®¹**ï¼š
- 4 ä¸ªé˜¶æ®µçš„ 47 ä¸ªæ­¥éª¤çš„ checklist
- MVP éªŒæ”¶æ ‡å‡†çš„ checklist
- å®Œæˆæƒ…å†µçš„å‹¾é€‰æ ‡è®°

**ä½¿ç”¨åœºæ™¯**ï¼š
- è·Ÿè¸ªé¡¹ç›®æ•´ä½“è¿›åº¦
- äº†è§£å·²å®Œæˆçš„æ­¥éª¤
- ç¡®å®šä¸‹ä¸€æ­¥è¦åšä»€ä¹ˆ
- ç”Ÿæˆé¡¹ç›®è¿›åº¦æŠ¥å‘Š

---

#### 5. `architecture.md`ï¼ˆå½“å‰æ–‡ä»¶ï¼‰
**ç”¨é€”**ï¼šé¡¹ç›®æ¶æ„ã€æ–‡ä»¶ç»“æ„å’Œå„éƒ¨åˆ†ä½œç”¨è¯´æ˜
**å†…å®¹**ï¼š
- æ–‡æ¡£æ–‡ä»¶è¯´æ˜
- å‰ç«¯ç›®å½•ç»“æ„ä¸æ–‡ä»¶ä½œç”¨
- æ•°æ®åº“è¡¨çš„è®¾è®¡è¯´æ˜
- å…³é”®æ•°æ®æµ
- å¼€å‘çº¦å®š

**ä½¿ç”¨åœºæ™¯**ï¼š
- ç†è§£é¡¹ç›®æ•´ä½“ç»“æ„
- æ–°å¼€å‘è€…å¿«é€Ÿä¸Šæ‰‹
- æŸ¥è¯¢æŸä¸ªæ–‡ä»¶çš„ç”¨é€”
- æ·»åŠ æ–°é¡µé¢æˆ–ç»„ä»¶æ—¶å‚è€ƒ

---

## å‰ç«¯é¡¹ç›®ç»“æ„è¯´æ˜

### æ ¹ç›®å½•ç»“æ„ï¼ˆå¼€å‘åï¼‰

```
fe2/
â”œâ”€â”€ app/                          # Next.js App Router æ ¸å¿ƒ
â”‚   â”œâ”€â”€ layout.tsx                # å…¨å±€å¸ƒå±€ - å¤´éƒ¨ã€è„šéƒ¨ã€å…¨å±€æ ·å¼
â”‚   â”œâ”€â”€ page.tsx                  # é¦–é¡µ / ç™»é™†å‰é¡µé¢
â”‚   â”œâ”€â”€ (auth)/                   # è®¤è¯ç›¸å…³è·¯ç”±ç»„
â”‚   â”‚   â”œâ”€â”€ login/page.tsx        # é‚®ç®±/GitHub ç™»å½•é¡µé¢
â”‚   â”‚   â””â”€â”€ register/page.tsx     # ç”¨æˆ·æ³¨å†Œé¡µé¢
â”‚   â”œâ”€â”€ (dashboard)/              # å—ä¿æŠ¤çš„è·¯ç”±ç»„ï¼ˆéœ€ç™»å½•ï¼‰
â”‚   â”‚   â”œâ”€â”€ layout.tsx            # ä»ªè¡¨æ¿å¸ƒå±€ - ä¾§è¾¹æ ã€é¡¶éƒ¨å¯¼èˆª
â”‚   â”‚   â”œâ”€â”€ dashboard/page.tsx    # ä»ªè¡¨æ¿é¦–é¡µ - ç”¨æˆ·ä¿¡æ¯ã€ä»Šæ—¥ç»Ÿè®¡
â”‚   â”‚   â”œâ”€â”€ questions/page.tsx    # é¢˜ç›®æµè§ˆé¡µ - ç­›é€‰é¢˜ç›®ã€åˆ—è¡¨å±•ç¤º
â”‚   â”‚   â”œâ”€â”€ [year]/[questionId]/page.tsx  # å•é¢˜åšé¢˜é¡µ - æ ¸å¿ƒåšé¢˜ç•Œé¢
â”‚   â”‚   â”œâ”€â”€ wrong-book/page.tsx   # é”™é¢˜æœ¬é¡µ - æ˜¾ç¤ºæ‰€æœ‰é”™é¢˜
â”‚   â”‚   â”œâ”€â”€ wrong-review/page.tsx # é”™é¢˜å¤ä¹ é¡µ - ä¸“é—¨å¤ä¹ é”™é¢˜
â”‚   â”‚   â”œâ”€â”€ bookmarks/page.tsx    # ä¹¦ç­¾é¡µ - æ˜¾ç¤ºæ”¶è—é¢˜ç›®
â”‚   â”‚   â””â”€â”€ stats/page.tsx        # ç»Ÿè®¡é¡µ - å›¾è¡¨å’Œæ•°æ®å±•ç¤º
â”‚   â””â”€â”€ api/                      # åç«¯ API è·¯ç”±
â”‚       â”œâ”€â”€ answers/route.ts      # æäº¤ç­”æ¡ˆæ¥å£
â”‚       â”œâ”€â”€ wrong-questions/route.ts # è·å–é”™é¢˜åˆ—è¡¨æ¥å£
â”‚       â”œâ”€â”€ bookmarks/route.ts    # ä¹¦ç­¾å¢åˆ æ¥å£
â”‚       â”œâ”€â”€ mark-mastered/route.ts # æ ‡è®°æŒæ¡æ¥å£
â”‚       â”œâ”€â”€ focus-logs/route.ts   # ä¿å­˜ç•ªèŒ„é’Ÿè®°å½•æ¥å£
â”‚       â””â”€â”€ xp/route.ts           # ç»éªŒå€¼ç›¸å…³æ¥å£
â”‚
â”œâ”€â”€ components/                   # å¯å¤ç”¨çš„ React ç»„ä»¶
â”‚   â”œâ”€â”€ QuestionCard.tsx          # é¢˜ç›®å¡ç‰‡ - åœ¨åˆ—è¡¨ä¸­æ˜¾ç¤ºå•ä¸ªé¢˜ç›®
â”‚   â”œâ”€â”€ Pomodoro.tsx              # ç•ªèŒ„é’Ÿè®¡æ—¶å™¨ - å€’è®¡æ—¶ UI å’Œæ§åˆ¶
â”‚   â”œâ”€â”€ LevelUpNotification.tsx   # å‡çº§åŠ¨ç”»é€šçŸ¥ - Framer Motion åŠ¨ç”»
â”‚   â”œâ”€â”€ ProgressBar.tsx           # è¿›åº¦æ¡ - ç”¨äºæ˜¾ç¤ºåšé¢˜è¿›åº¦
â”‚   â”œâ”€â”€ StatCard.tsx              # ç»Ÿè®¡å¡ç‰‡ - æ˜¾ç¤ºå„ç§ç»Ÿè®¡æ•°æ®
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ LoginForm.tsx         # ç™»å½•è¡¨å•é€»è¾‘
â”‚   â”‚   â””â”€â”€ RegisterForm.tsx      # æ³¨å†Œè¡¨å•é€»è¾‘
â”‚   â””â”€â”€ ui/                       # shadcn/ui ç»„ä»¶ï¼ˆå·²å®ç° 6 ä¸ªåŸºç¡€ç»„ä»¶ï¼‰
â”‚       â”œâ”€â”€ button.tsx            # âœ… æŒ‰é’®ç»„ä»¶ - å¤šç§å˜ä½“ï¼ˆdefault, destructive, outline, secondary, ghost, linkï¼‰
â”‚       â”œâ”€â”€ card.tsx              # âœ… å¡ç‰‡ç»„ä»¶ - Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent
â”‚       â”œâ”€â”€ input.tsx             # âœ… è¾“å…¥æ¡†ç»„ä»¶ - æ–‡æœ¬è¾“å…¥å…ƒç´ 
â”‚       â”œâ”€â”€ label.tsx             # âœ… æ ‡ç­¾ç»„ä»¶ - è¡¨å•æ ‡ç­¾
â”‚       â”œâ”€â”€ progress.tsx          # âœ… è¿›åº¦æ¡ç»„ä»¶ - æ˜¾ç¤ºåšé¢˜è¿›åº¦ã€å‡çº§è¿›åº¦
â”‚       â”œâ”€â”€ alert-dialog.tsx      # âœ… è­¦å‘Šå¯¹è¯æ¡† - ç¡®è®¤å¯¹è¯æ¡†ã€è­¦å‘Šæç¤º
â”‚       â””â”€â”€ ...å¾…åç»­æ·»åŠ çš„ç»„ä»¶  # Select, Textarea, Dialog, Tooltip ç­‰
â”‚
â”œâ”€â”€ lib/                          # å·¥å…·å‡½æ•°å’Œé…ç½®
â”‚   â”œâ”€â”€ supabase.ts               # âœ… Supabase å®¢æˆ·ç«¯ - å•ä¾‹æ¨¡å¼ï¼Œå…¨å±€å¤ç”¨
â”‚   â”‚   â””â”€â”€ createClient() è°ƒç”¨  # åˆå§‹åŒ– Supabase å®ä¾‹ï¼Œä» .env.local è¯»å–å‡­è¯
â”‚   â”œâ”€â”€ types.ts                  # âœ… TypeScript ç±»å‹å®šä¹‰ - 8 ä¸ªæ ¸å¿ƒç±»å‹
â”‚   â”‚   â”œâ”€â”€ Profile              # ç”¨æˆ·æ¡£æ¡ˆ
â”‚   â”‚   â”œâ”€â”€ Question             # é¢˜åº“é¢˜ç›®
â”‚   â”‚   â”œâ”€â”€ UserProgress         # åšé¢˜è¿›åº¦æ±‡æ€»
â”‚   â”‚   â”œâ”€â”€ QuestionAttempt      # åšé¢˜å†å²è®°å½•
â”‚   â”‚   â”œâ”€â”€ Bookmark             # ä¹¦ç­¾
â”‚   â”‚   â”œâ”€â”€ FocusSession         # ç•ªèŒ„é’Ÿä¼šè¯
â”‚   â”‚   â”œâ”€â”€ ApiResponse<T>       # API ç»Ÿä¸€å“åº”æ ¼å¼
â”‚   â”‚   â””â”€â”€ AuthUser             # ç™»å½•ç”¨æˆ·ä¿¡æ¯
â”‚   â””â”€â”€ utils.ts                  # âœ… é€šç”¨å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ cn()                  # Tailwind CSS ç±»ååˆå¹¶ï¼ˆclsx + twMergeï¼‰
â”‚       â”œâ”€â”€ calculateLevel()      # å¾…å®ç°ï¼šæ ¹æ® XP è®¡ç®—ç­‰çº§
â”‚       â”œâ”€â”€ getXpForNextLevel()  # å¾…å®ç°ï¼šè·å–ä¸‹ä¸€çº§æ‰€éœ€ XP
â”‚       â”œâ”€â”€ formatTime()         # å¾…å®ç°ï¼šæ ¼å¼åŒ–æ—¶é—´
â”‚       â””â”€â”€ ...å…¶ä»–å·¥å…·å‡½æ•°
â”‚
â”œâ”€â”€ store/                        # Zustand çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ pomodoroStore.ts          # ç•ªèŒ„é’ŸçŠ¶æ€ - å€’è®¡æ—¶ã€è¿è¡ŒçŠ¶æ€ã€å†å²è®°å½•
â”‚   â”œâ”€â”€ quizStore.ts              # åšé¢˜çŠ¶æ€ - å½“å‰é¢˜ç›®ã€ç­”æ¡ˆã€è¿›åº¦
â”‚   â”œâ”€â”€ authStore.ts              # è®¤è¯çŠ¶æ€ - ç”¨æˆ·ä¿¡æ¯ã€ç™»å½•çŠ¶æ€
â”‚   â””â”€â”€ appStore.ts               # åº”ç”¨å…¨å±€çŠ¶æ€ - ä¸»é¢˜ã€é€šçŸ¥ç­‰
â”‚
â”œâ”€â”€ hooks/                        # è‡ªå®šä¹‰ React Hooksï¼ˆå¯é€‰ï¼‰
â”‚   â”œâ”€â”€ useAuth.ts                # è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
â”‚   â”œâ”€â”€ useProgress.ts            # è·å–ç”¨æˆ·è¿›åº¦æ•°æ®
â”‚   â””â”€â”€ usePomodoro.ts            # æ§åˆ¶ç•ªèŒ„é’ŸçŠ¶æ€
â”‚
â”œâ”€â”€ public/                       # é™æ€èµ„æº
â”‚   â”œâ”€â”€ images/
â”‚   â”‚   â””â”€â”€ logo.png              # åº”ç”¨ Logo
â”‚   â””â”€â”€ locales/                  # å›½é™…åŒ–æ–‡ä»¶
â”‚       â”œâ”€â”€ zh/common.json        # ä¸­æ–‡ç¿»è¯‘
â”‚       â””â”€â”€ ja/common.json        # æ—¥æ–‡ç¿»è¯‘
â”‚
â”œâ”€â”€ styles/                       # å…¨å±€æ ·å¼
â”‚   â””â”€â”€ globals.css               # å…¨å±€ CSSï¼ˆTailwindï¼‰
â”‚
â”œâ”€â”€ .env.local                    # ç¯å¢ƒå˜é‡ï¼ˆgit å¿½ç•¥ï¼‰
â”œâ”€â”€ .gitignore                    # Git å¿½ç•¥æ–‡ä»¶åˆ—è¡¨
â”œâ”€â”€ package.json                  # é¡¹ç›®ä¾èµ–å’Œè„šæœ¬
â”œâ”€â”€ tsconfig.json                 # TypeScript é…ç½®
â”œâ”€â”€ tailwind.config.ts            # Tailwind CSS é…ç½®
â”œâ”€â”€ next.config.js                # Next.js é…ç½®
â””â”€â”€ CLAUDE.md                     # Claude Code é¡¹ç›®æŒ‡å—
```

---

## æ•°æ®åº“è¡¨è®¾è®¡è¯´æ˜

### æ•°æ®åº“è¡¨æ€»è§ˆ

| è¡¨å | ç”¨é€” | è¡Œæ•°é¢„ä¼° | RLS | å…³é”®ç´¢å¼• | å…³é”®å­—æ®µ |
|------|------|---------|-----|---------|---------|
| `auth.users` | ç”¨æˆ·èº«ä»½è®¤è¯ï¼ˆSupabase ç®¡ç†ï¼‰ | å°‘ | å†…ç½® | email | id, email |
| `profiles` | ç”¨æˆ·æ¡£æ¡ˆã€ç­‰çº§ã€XPã€è¿å‡» | å°‘ | âœ… | user_id | id, level, xp |
| `questions` | é¢˜åº“é¢˜ç›® | å¤šï¼ˆå‡ åƒï¼‰ | âœ— | year, category | id, content, correct_answer |
| `user_progress` | åšé¢˜ç»Ÿè®¡ï¼ˆæ ¸å¿ƒæ±‡æ€»è¡¨ï¼‰ | ä¸­-å¤š | âœ… | (user_id, question_id) | status, consecutive_correct_count |
| `question_attempts` | åšé¢˜å†å²è®°å½• | å¾ˆå¤šï¼ˆæ¯åšä¸€é¢˜+1ï¼‰ | âœ… | (user_id, question_id, created_at) | user_answer, is_correct |
| `bookmarks` | ç”¨æˆ·ä¹¦ç­¾ | ä¸­ | âœ… | user_id | user_id, question_id |
| `focus_sessions` | ç•ªèŒ„é’Ÿä¼šè¯ | ä¸­ | âœ… | (user_id, created_at) | started_at, ended_at, duration |

**è¯´æ˜**ï¼š
- **RLS**ï¼šè¡Œçº§å®‰å…¨ï¼Œç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®
- **å…³é”®ç´¢å¼•**ï¼šç”¨äºä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½çš„ç´¢å¼•
- **åŒè¡¨è®¾è®¡**ï¼š`user_progress` + `question_attempts` çš„ç»„åˆè®¾è®¡ä¾¿äºå¿«é€Ÿç»Ÿè®¡å’Œå†å²è¿½è¸ª

---

### Supabase PostgreSQL æ•°æ®åº“

#### 1. `auth.users`ï¼ˆç”± Supabase è‡ªåŠ¨ç®¡ç†ï¼‰
**ç”¨é€”**ï¼šç”¨æˆ·èº«ä»½è®¤è¯è¡¨
**å…³é”®å­—æ®µ**ï¼š
- `id` (UUID): ç”¨æˆ·å”¯ä¸€æ ‡è¯†
- `email`: é‚®ç®±åœ°å€
- `created_at`, `updated_at`: æ—¶é—´æˆ³

**è¯´æ˜**ï¼šç”± Supabase è‡ªåŠ¨ç®¡ç†ï¼Œä¸éœ€è¦æ‰‹åŠ¨æ“ä½œã€‚ä¸ `profiles` è¡¨é€šè¿‡ `id` å…³è”ã€‚

---

#### 2. `profiles`
**ç”¨é€”**ï¼šç”¨æˆ·ä¸ªäººä¿¡æ¯å’Œæ¸¸æˆåŒ–æ•°æ®
**å­—æ®µè¯´æ˜**ï¼š
- `id` (UUID, PK): å…³è” auth.users
- `username` (text): ç”¨æˆ·å
- `level` (int): å½“å‰ç­‰çº§ï¼ˆé»˜è®¤ 1ï¼‰
- `xp` (int): ç´¯ç§¯ç»éªŒå€¼ï¼ˆé»˜è®¤ 0ï¼‰
- `streak_days` (int): è¿ç»­æ‰“å¡å¤©æ•°ï¼ˆé»˜è®¤ 0ï¼‰
- `created_at`, `updated_at`: æ—¶é—´æˆ³

**ç”¨é€”**ï¼šå­˜å‚¨ç”¨æˆ·ç­‰çº§ã€ç»éªŒå€¼ã€è¿å‡»ç­‰æ¸¸æˆåŒ–ä¿¡æ¯ã€‚

---

#### 3. `questions`
**ç”¨é€”**ï¼šé¢˜åº“ï¼Œå­˜å‚¨æ‰€æœ‰ FE è€ƒè¯•é¢˜ç›®
**å­—æ®µè¯´æ˜**ï¼š
- `id` (UUID, PK): é¢˜ç›®å”¯ä¸€æ ‡è¯†
- `year` (text): è€ƒè¯•å¹´ä»½ï¼ˆå¦‚ "2023_Spring"ï¼‰
- `session` (text): è€ƒè¯•æ—¶æ®µï¼ˆ"AM" æˆ– "PM"ï¼‰
- `category` (text): çŸ¥è¯†åˆ†ç±»ï¼ˆ"Security", "Database" ç­‰ï¼‰
- `question_number` (int): é¢˜å·ï¼ˆ1-80ï¼‰
- `content` (text): é¢˜å¹²æ–‡æœ¬
- `option_a`, `option_b`, `option_c`, `option_d` (text): å››ä¸ªé€‰é¡¹
- `correct_answer` (text): æ­£ç¡®ç­”æ¡ˆï¼ˆ"A", "B", "C", "D"ï¼‰
- `explanation` (text): é¢˜ç›®è§£æ
- `difficulty` (text): éš¾åº¦ï¼ˆ"easy", "normal", "hard"ï¼‰
- `created_at`: åˆ›å»ºæ—¶é—´

**ç´¢å¼•**ï¼šyear, category (ç”¨äºå¿«é€ŸæŸ¥è¯¢)

---

#### 4. `user_progress`
**ç”¨é€”**ï¼šç”¨æˆ·åšé¢˜è®°å½•ï¼ˆæ ¸å¿ƒæ•°æ®è¡¨ï¼Œæ±‡æ€»ç»Ÿè®¡ï¼‰
**å­—æ®µè¯´æ˜**ï¼š
- `id` (UUID, PK): è®°å½•å”¯ä¸€æ ‡è¯†
- `user_id` (UUID, FK): å…³è” auth.users
- `question_id` (UUID, FK): å…³è” questions
- `user_answer` (text): ç”¨æˆ·æœ€åä¸€æ¬¡çš„ç­”æ¡ˆï¼ˆ"A", "B", "C", "D"ï¼‰
- `is_correct` (boolean): æœ€åä¸€æ¬¡æ˜¯å¦ç­”å¯¹
- `attempt_count` (int): æ­¤é¢˜åšè¿‡çš„æ€»æ¬¡æ•°
- `consecutive_correct_count` (int): è¿ç»­ç­”å¯¹æ¬¡æ•°ï¼ˆè¾¾åˆ° 3 æ¬¡æ—¶è‡ªåŠ¨æ ‡è®°ä¸ºå·²æŒæ¡ï¼‰
- `status` (text): é¢˜ç›®çŠ¶æ€ï¼ˆ"normal", "wrong_book", "mastered"ï¼‰
  - `normal`: æ™®é€šçŠ¶æ€ï¼ˆæœ€åç­”å¯¹æˆ–é¦–æ¬¡åšé¢˜ï¼‰
  - `wrong_book`: åœ¨é”™é¢˜æœ¬ä¸­ï¼ˆç­”è¿‡ä½†æœ€åç­”é”™ï¼‰
  - `mastered`: å·²æŒæ¡ï¼ˆè¿ç»­ç­”å¯¹ 3 æ¬¡æˆ–æ‰‹åŠ¨æ ‡è®°ï¼‰
- `last_attempt_at` (timestamp): æœ€åä¸€æ¬¡åšé¢˜çš„æ—¶é—´
- `created_at`: é¦–æ¬¡åšé¢˜æ—¶é—´

**ç´¢å¼•**ï¼š
- (user_id, question_id) å”¯ä¸€ç»„åˆç´¢å¼•
- user_id ç´¢å¼•ï¼ˆå¿«é€ŸæŸ¥è¯¢ç”¨æˆ·çš„æ‰€æœ‰é¢˜ç›®ï¼‰
- status ç´¢å¼•ï¼ˆå¿«é€Ÿç­›é€‰é”™é¢˜ï¼‰

**RLS ç­–ç•¥**ï¼šç”¨æˆ·åªèƒ½æŸ¥çœ‹/ä¿®æ”¹è‡ªå·±çš„è®°å½•

**è¯´æ˜**ï¼š
- è¿™æ˜¯æœ€é‡è¦çš„æ±‡æ€»ç»Ÿè®¡è¡¨ï¼Œè®°å½•äº†ç”¨æˆ·å¯¹æ¯é“é¢˜ç›®çš„æœ€æ–°åšé¢˜æƒ…å†µ
- ä¸ `question_attempts` é…åˆä½¿ç”¨ï¼ˆåŒè¡¨è®¾è®¡ï¼‰
- ç”¨äºå¿«é€Ÿç»Ÿè®¡ç”¨æˆ·çš„åšé¢˜æ•°é‡ã€æ­£ç¡®ç‡ã€é”™é¢˜æœ¬ç­‰
- `consecutive_correct_count` å­—æ®µç”¨äºè¿½è¸ªè¿ç»­ç­”å¯¹ï¼Œå®ç°æ™ºèƒ½æŒæ¡åˆ¤å®š

---

#### 4.5. `question_attempts`ï¼ˆâœ… æ–°å¢ï¼‰
**ç”¨é€”**ï¼šç”¨æˆ·åšé¢˜å†å²è¿½è¸ªè¡¨ï¼ˆè¯¦ç»†å†å²è®°å½•ï¼‰
**å­—æ®µè¯´æ˜**ï¼š
- `id` (UUID, PK): å†å²è®°å½•å”¯ä¸€æ ‡è¯†
- `user_id` (UUID, FK): å…³è” auth.users
- `question_id` (UUID, FK): å…³è” questions
- `user_answer` (text): æœ¬æ¬¡çš„ç­”æ¡ˆï¼ˆ"A", "B", "C", "D"ï¼‰
- `is_correct` (boolean): æœ¬æ¬¡æ˜¯å¦ç­”å¯¹
- `pomodoro_session_id` (UUID, FK): å…³è” focus_sessionsï¼ˆå¯é€‰ï¼Œç”¨äºå…³è”ç•ªèŒ„é’Ÿï¼‰
- `created_at` (timestamp): åšé¢˜çš„æ—¶é—´æˆ³

**ç´¢å¼•**ï¼š
- user_id ç´¢å¼•ï¼ˆå¿«é€ŸæŸ¥è¯¢ç”¨æˆ·å†å²ï¼‰
- (user_id, question_id, created_at) å¤åˆç´¢å¼•ï¼ˆå¿«é€ŸæŸ¥è¯¢æŸç”¨æˆ·æŸé¢˜çš„å†å²ï¼‰

**RLS ç­–ç•¥**ï¼šç”¨æˆ·åªèƒ½æŸ¥çœ‹/æ’å…¥/åˆ é™¤è‡ªå·±çš„è®°å½•

**è¯´æ˜**ï¼š
- ä¸ `user_progress` é…åˆä½¿ç”¨ï¼Œæ„æˆåŒè¡¨è®¾è®¡
- æ¯æ¬¡åšé¢˜éƒ½ä¼šæ’å…¥ä¸€æ¡æ–°è®°å½•ï¼Œä¿ç•™å®Œæ•´çš„å­¦ä¹ è½¨è¿¹
- ç”¨äºæ•°æ®åˆ†æã€å­¦ä¹ æ›²çº¿è¿½è¸ªã€ç•ªèŒ„ç»Ÿè®¡ç­‰é«˜çº§åŠŸèƒ½
- ä¸ä¿®æ”¹å†å²æ•°æ®ï¼Œåªæ’å…¥æ–°è®°å½•ï¼Œç¡®ä¿æ•°æ®å®Œæ•´æ€§

---

#### 5. `bookmarks`
**ç”¨é€”**ï¼šç”¨æˆ·æ”¶è—çš„é¢˜ç›®
**å­—æ®µè¯´æ˜**ï¼š
- `id` (UUID, PK): ä¹¦ç­¾å”¯ä¸€æ ‡è¯†
- `user_id` (UUID, FK): å…³è” auth.users
- `question_id` (UUID, FK): å…³è” questions
- `created_at` (timestamp): æ·»åŠ ä¹¦ç­¾çš„æ—¶é—´

**çº¦æŸ**ï¼š(user_id, question_id) å”¯ä¸€çº¦æŸï¼ˆé˜²æ­¢é‡å¤ï¼‰

**RLS ç­–ç•¥**ï¼šç”¨æˆ·åªèƒ½æŸ¥çœ‹/ä¿®æ”¹è‡ªå·±çš„ä¹¦ç­¾

---

#### 5.5. `focus_sessions`ï¼ˆâœ… æ–°å¢ï¼‰
**ç”¨é€”**ï¼šç•ªèŒ„é’Ÿä¼šè¯è®°å½•ï¼ˆç²¾ç¡®çš„å­¦ä¹ æ—¶é—´è¿½è¸ªï¼‰
**å­—æ®µè¯´æ˜**ï¼š
- `id` (UUID, PK): ä¼šè¯å”¯ä¸€æ ‡è¯†
- `user_id` (UUID, FK): å…³è” auth.users
- `started_at` (timestamp): ä¼šè¯å¼€å§‹æ—¶é—´
- `ended_at` (timestamp, nullable): ä¼šè¯ç»“æŸæ—¶é—´ï¼ˆæœªå®Œæˆæ—¶ä¸º nullï¼‰
- `duration` (int): é¢„è®¡æ—¶é•¿ï¼ˆç§’ï¼Œé€šå¸¸ 1500 = 25 åˆ†é’Ÿï¼‰
- `goal_description` (text, nullable): å­¦ä¹ ç›®æ ‡æè¿°ï¼ˆå¦‚"åˆ·é¢˜ 20 é¢˜"ï¼‰
- `created_at` (timestamp): ä¼šè¯åˆ›å»ºæ—¶é—´

**ç´¢å¼•**ï¼š
- user_id ç´¢å¼•ï¼ˆå¿«é€ŸæŸ¥è¯¢ç”¨æˆ·çš„ç•ªèŒ„å†å²ï¼‰
- (user_id, created_at) å¤åˆç´¢å¼•ï¼ˆå¿«é€ŸæŸ¥è¯¢ç”¨æˆ·æŸæ—¶é—´æ®µçš„ä¼šè¯ï¼‰

**RLS ç­–ç•¥**ï¼šç”¨æˆ·åªèƒ½æŸ¥çœ‹/ä¿®æ”¹è‡ªå·±çš„ä¼šè¯

**ä¸å…¶ä»–è¡¨çš„å…³ç³»**ï¼š
- `question_attempts.pomodoro_session_id` FK å…³è”æ­¤è¡¨
- ç•ªèŒ„ç»“æŸæ—¶ï¼Œå¯é€šè¿‡ `question_attempts` ç»Ÿè®¡æœ¬æ¬¡å®Œæˆçš„é¢˜æ•°å’Œæ­£ç¡®æ•°

**è¯´æ˜**ï¼š
- ç²¾ç¡®è¿½è¸ªç”¨æˆ·çš„ç•ªèŒ„é’Ÿä½¿ç”¨æƒ…å†µ
- ä¿ç•™äº†å®Œæ•´çš„å¼€å§‹/ç»“æŸæ—¶é—´ï¼Œä¾¿äºåˆ†æå­¦ä¹ ä¹ æƒ¯
- ä¸ `question_attempts` è”åŠ¨ï¼Œå¯åˆ†æ"è¿™ä¸ªç•ªèŒ„é’Ÿä¸­åšäº†å“ªäº›é¢˜"

---

#### 6. `focus_logs`ï¼ˆå¯é€‰ï¼Œç”¨äºç®€åŒ–ç»Ÿè®¡ï¼‰
**ç”¨é€”**ï¼šç•ªèŒ„é’Ÿç»Ÿè®¡è®°å½•ï¼ˆé«˜å±‚èšåˆæ•°æ®ï¼‰
**å­—æ®µè¯´æ˜**ï¼š
- `id` (UUID, PK): è®°å½•å”¯ä¸€æ ‡è¯†
- `user_id` (UUID, FK): å…³è” auth.users
- `duration` (int): æœ¬æ¬¡ç•ªèŒ„çš„æ—¶é•¿ï¼ˆç§’ï¼‰
- `questions_completed` (int): æœ¬æ¬¡å®Œæˆçš„é¢˜ç›®æ•°
- `correct_count` (int): æœ¬æ¬¡æ­£ç¡®çš„é¢˜ç›®æ•°
- `created_at` (timestamp): å®Œæˆæ—¶é—´

**è¯´æ˜**ï¼š
- è¿™æ˜¯ä» `focus_sessions` + `question_attempts` æ±‡æ€»è€Œæ¥çš„ç»Ÿè®¡è¡¨
- MVP ç‰ˆæœ¬å¯ä»¥ä¸åˆ›å»ºæ­¤è¡¨ï¼Œæ”¹ç”¨è”è¡¨æŸ¥è¯¢å³å¯
- å¦‚æœç»Ÿè®¡è®¡ç®—å˜æ…¢ï¼Œå¯åç»­æ·»åŠ æ­¤è¡¨è¿›è¡Œä¼˜åŒ–

---

## å…³é”®æ•°æ®æµ

### ç”¨æˆ·åšé¢˜æµç¨‹
```
1. ç”¨æˆ·ç™»å½• â†’ Supabase Auth éªŒè¯
2. è¿›å…¥é¢˜ç›®æµè§ˆé¡µ â†’ ä» questions è¡¨æŸ¥è¯¢é¢˜ç›®
3. é€‰æ‹©é¢˜ç›®è¿›å…¥åšé¢˜é¡µ
4. ç”¨æˆ·é€‰æ‹©ç­”æ¡ˆ â†’ æäº¤åˆ° /api/answers
5. API å¯¹æ¯”æ­£ç¡®ç­”æ¡ˆ â†’ å†™å…¥ user_progress è¡¨
   - å¦‚æœé”™è¯¯ï¼Œstatus = 'wrong_book'
   - å¦‚æœæ­£ç¡®ï¼Œstatus = 'normal'ï¼Œå¢åŠ  XP
6. æ›´æ–° profiles è¡¨ä¸­çš„ xp å’Œ level
7. å‰ç«¯æ˜¾ç¤ºç»“æœå’Œä¸‹ä¸€æ­¥é€‰é¡¹
```

### é”™é¢˜å¤ä¹ æµç¨‹
```
1. ç”¨æˆ·è®¿é—®é”™é¢˜æœ¬ â†’ /api/wrong-questions
2. API æŸ¥è¯¢ user_progress WHERE status='wrong_book'
3. å‰ç«¯æ˜¾ç¤ºé”™é¢˜åˆ—è¡¨
4. ç”¨æˆ·ç‚¹å‡»"å†åšä¸€é" â†’ è¿›å…¥åšé¢˜é¡µ
5. å®Œæˆç­”é¢˜ â†’ å†™å…¥ user_progressï¼ˆattempt_count+1ï¼‰
6. è¿ç»­ç­”å¯¹ 3 æ¬¡ â†’ æ˜¾ç¤º"æ ‡è®°å·²æŒæ¡"é€‰é¡¹
7. ç”¨æˆ·ç‚¹å‡» â†’ è°ƒç”¨ /api/mark-mastered
8. æ›´æ–° status='mastered'ï¼Œä»é”™é¢˜æœ¬ç§»å‡º
```

### ç•ªèŒ„é’Ÿæµç¨‹
```
1. ç”¨æˆ·ç‚¹å‡»"å¼€å§‹ç•ªèŒ„" â†’ Zustand store çŠ¶æ€å˜ä¸º running
2. æ¯ç§’è°ƒç”¨ decrementTime() â†’ timeLeft å‡ 1
3. é¡µé¢åˆ·æ–° â†’ ä» localStorage æ¢å¤ timeLeft
4. timeLeft = 0 â†’ åœæ­¢è®¡æ—¶ï¼Œæ˜¾ç¤ºå®ŒæˆåŠ¨ç”»
5. ç‚¹å‡»"å®Œæˆ" â†’ è°ƒç”¨ /api/focus-logs
6. API ä¿å­˜ focus_logs è®°å½•ï¼Œæ›´æ–° profiles çš„ xp
7. æ£€æŸ¥æ˜¯å¦å‡çº§ â†’ æ˜¾ç¤ºå‡çº§åŠ¨ç”»
```

---

## å‰ç«¯å¼€å‘çº¦å®š

### é¡µé¢ç»„ä»¶å‘½å
- **page.tsx**: Next.js è·¯ç”±æ–‡ä»¶ï¼Œè¡¨ç¤ºè¯¥è·¯ç”±çš„ä¸»é¡µé¢
- **layout.tsx**: å¸ƒå±€æ–‡ä»¶ï¼Œä¸ºè¯¥è·¯ç”±åŠå…¶å­è·¯ç”±æä¾›ç»Ÿä¸€çš„å¸ƒå±€
- åŠ¨æ€è·¯ç”±ä½¿ç”¨ `[param]` å‘½åï¼ˆå¦‚ `[questionId]`ï¼‰
- åˆ†ç»„è·¯ç”±ä½¿ç”¨ `(groupName)` å‘½åï¼ˆå¦‚ `(dashboard)`ï¼‰

### ç»„ä»¶å‘½å
- **é¡µé¢ç»„ä»¶**ï¼ˆåœ¨ app/ ä¸­çš„ï¼‰: `PascalCase` ä¸”ä¸æ–‡ä»¶ååŒå
- **é€šç”¨ç»„ä»¶**ï¼ˆåœ¨ components/ ä¸­ï¼‰: `PascalCase`
- **Hooks**: `use` å¼€å¤´çš„é©¼å³°å‘½å
- **å·¥å…·å‡½æ•°**: é©¼å³°å‘½å

### çŠ¶æ€ç®¡ç†
- **å…¨å±€çŠ¶æ€**ï¼ˆç”¨æˆ·è®¤è¯ã€åº”ç”¨ä¸»é¢˜ï¼‰: Zustand store
- **é¡µé¢å±€éƒ¨çŠ¶æ€**ï¼ˆè¡¨å•è¾“å…¥ã€æ¨¡æ€æ¡†å¼€å…³ï¼‰: React useState/useReducer
- **æœåŠ¡å™¨æ•°æ®**ï¼ˆé¢˜ç›®ã€ç”¨æˆ·è¿›åº¦ï¼‰: Server Components + SWR/React Queryï¼ˆå¦‚éœ€ç¼“å­˜ï¼‰

### æ•°æ®è·å–
- **æœåŠ¡å™¨ä¾§**ï¼ˆåˆå§‹åŠ è½½ï¼‰: Next.js Server Components
- **å®¢æˆ·ç«¯ä¾§**ï¼ˆäº¤äº’æ•°æ®ï¼‰: Supabase Client SDK
- **API Routes**: ä»…ç”¨äºéœ€è¦å¤æ‚é€»è¾‘æˆ–æ•°æ®è½¬æ¢çš„æ“ä½œ

### æ ·å¼
- **å…¨å±€æ ·å¼**: Tailwind CSS å·¥å…·ç±»
- **ç»„ä»¶æ ·å¼**: ä½¿ç”¨ `className` å±æ€§
- **åŠ¨ç”»**: Framer Motion
- **ä¸è¦**åˆ›å»º CSS Moduleï¼ˆä½¿ç”¨ Tailwind å·²è¶³å¤Ÿï¼‰

### ç±»å‹å®‰å…¨
- æ‰€æœ‰ API å“åº”éƒ½åº”æœ‰å¯¹åº”çš„ TypeScript ç±»å‹
- ä½¿ç”¨ `lib/types.ts` é›†ä¸­ç®¡ç†æ‰€æœ‰ç±»å‹
- é¿å… `any` ç±»å‹ï¼Œä½¿ç”¨ `unknown` æˆ– `as const` æ›¿ä»£

---

## é˜¶æ®µæ€§å¼€å‘ç›®æ ‡

### å®Œæˆåä½ å°†æ‹¥æœ‰
1. **å®Œæ•´çš„ç”¨æˆ·è®¤è¯ç³»ç»Ÿ**ï¼šé‚®ç®± + GitHub OAuth ç™»å½•
2. **æ ¸å¿ƒçš„åšé¢˜å¼•æ“**ï¼šæµè§ˆã€ç­›é€‰ã€åšé¢˜ã€å³æ—¶åé¦ˆ
3. **æ™ºèƒ½çš„é”™é¢˜æœ¬**ï¼šè‡ªåŠ¨æ”¶é›†ã€å¯å¤ä¹ ã€å¯æ ‡è®°æŒæ¡
4. **æœ‰è¶£çš„ç•ªèŒ„é’Ÿ**ï¼šå€’è®¡æ—¶ã€è®°å½•ã€ä¸ XP ç³»ç»Ÿè”åŠ¨
5. **åŸºç¡€çš„æ¸¸æˆåŒ–**ï¼šç­‰çº§ã€ç»éªŒå€¼ã€å‡çº§åŠ¨ç”»
6. **æ¸…æ™°çš„æ•°æ®å¯è§†åŒ–**ï¼šç»Ÿè®¡é¡µé¢æ˜¾ç¤ºå­¦ä¹ è¿›åº¦
7. **ç§»åŠ¨ä¼˜å…ˆçš„è®¾è®¡**ï¼šåœ¨æ‰‹æœºå’Œæ¡Œé¢éƒ½èƒ½è‰¯å¥½ä½¿ç”¨

---

## å¸¸è§é—®é¢˜

**Q: ä¸ºä»€ä¹ˆç”¨ Zustand è€Œä¸æ˜¯ Context APIï¼Ÿ**
A: Zustand æ›´è½»é‡ï¼Œé¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“ï¼Œç‰¹åˆ«é€‚åˆç•ªèŒ„é’Ÿè¿™æ ·é¢‘ç¹æ›´æ–°çš„çŠ¶æ€ã€‚

**Q: Supabase RLS å¦‚ä½•ä¿æŠ¤ç”¨æˆ·éšç§ï¼Ÿ**
A: RLS åœ¨æ•°æ®åº“å±‚è®¾ç½®è§„åˆ™ï¼Œç¡®ä¿ç”¨æˆ·åªèƒ½æŸ¥è¯¢/ä¿®æ”¹è‡ªå·±çš„æ•°æ®ï¼Œæ¯”åº”ç”¨å±‚æ£€æŸ¥æ›´å®‰å…¨ã€‚

**Q: ä¸ºä»€ä¹ˆåˆ†äº† (auth) å’Œ (dashboard) è·¯ç”±ç»„ï¼Ÿ**
A: åˆ†ç»„æ–¹ä¾¿ç®¡ç†ï¼šauth æ˜¯å…¬å¼€é¡µé¢ï¼Œdashboard æ˜¯å—ä¿æŠ¤é¡µé¢ã€‚å¯ä¸ºä¸¤ä¸ªåˆ†ç»„åº”ç”¨ä¸åŒçš„ layoutã€‚

**Q: å¦‚ä½•æ‰©å±•åˆ° AP è€ƒè¯•ï¼Ÿ**
A: åœ¨ questions è¡¨æ·»åŠ  `exam_type` å­—æ®µåŒºåˆ† FE/APï¼Œæ‰€æœ‰æŸ¥è¯¢æ·»åŠ  `exam_type` è¿‡æ»¤æ¡ä»¶å³å¯ã€‚

---


---

## æ­¥éª¤ 2.1ï¼šSupabase å®¢æˆ·ç«¯åˆå§‹åŒ–æ–‡ä»¶ - æ¶æ„æ´å¯Ÿ

### å®ç°ç›®çš„
åˆ›å»ºä¸€ä¸ªå¯å¤ç”¨çš„ Supabase å®¢æˆ·ç«¯å®ä¾‹ï¼Œä½œä¸ºåº”ç”¨ä¸æ•°æ®åº“çš„é€šä¿¡æ¡¥æ¢ã€‚è¯¥æ–‡ä»¶éµå¾ªå•ä¾‹æ¨¡å¼ï¼Œç¡®ä¿å…¨å±€åªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯å®ä¾‹ã€‚

### æ–‡ä»¶ç»“æ„

**æ–‡ä»¶ä½ç½®**: `lib/supabase.ts`

**æ ¸å¿ƒå†…å®¹**:
```typescript
// 1. å¯¼å…¥ Supabase å®¢æˆ·ç«¯åˆ›å»ºå‡½æ•°
import { createClient } from "@supabase/supabase-js";

// 2. ä»ç¯å¢ƒå˜é‡è¯»å–è¿æ¥ä¿¡æ¯
const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;
const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;

// 3. éªŒè¯ç¯å¢ƒå˜é‡ï¼ˆé˜²æ­¢é…ç½®ç¼ºå¤±å¯¼è‡´çš„è¿è¡Œæ—¶é”™è¯¯ï¼‰
if (!supabaseUrl || !supabaseAnonKey) {
  throw new Error("Missing Supabase credentials...");
}

// 4. åˆ›å»ºå¹¶å¯¼å‡ºå•ä¾‹å®¢æˆ·ç«¯
export const supabase = createClient(supabaseUrl, supabaseAnonKey);
```

### å…³é”®è®¾è®¡å†³ç­–

#### 1. å•ä¾‹æ¨¡å¼ï¼ˆSingleton Patternï¼‰
- **ä¸ºä»€ä¹ˆ**ï¼šSupabase å®¢æˆ·ç«¯æ˜¯æ— çŠ¶æ€çš„è¿æ¥å™¨ï¼Œæ— éœ€å¤šä¸ªå®ä¾‹
- **å¥½å¤„**ï¼š
  - èŠ‚çœå†…å­˜ï¼ˆå…¨å±€åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼‰
  - ç»Ÿä¸€çš„è¿æ¥ç®¡ç†
  - é¿å…é‡å¤è®¤è¯
  - ä¾¿äºæµ‹è¯•ï¼ˆå¯ç›´æ¥ mock å•ä¾‹å¯¹è±¡ï¼‰
- **å®ç°æ–¹æ³•**ï¼šé€šè¿‡ ES6 `export` å¯¼å‡ºä¸€ä¸ªé¢„åˆ›å»ºçš„å®ä¾‹

#### 2. ç¯å¢ƒå˜é‡éªŒè¯
- **ä¸ºä»€ä¹ˆ**ï¼šå¼€å‘è¿‡ç¨‹ä¸­å®¹æ˜“å¿˜è®°é…ç½® `.env.local`
- **å¥½å¤„**ï¼š
  - åœ¨æ„å»ºæ—¶è€Œéè¿è¡Œæ—¶å‘ç°é…ç½®é—®é¢˜
  - æä¾›æ˜ç¡®çš„é”™è¯¯æç¤º
  - é˜²æ­¢è®¿é—® undefined å¯¼è‡´çš„éšè”½é”™è¯¯
- **å®ç°æ–¹æ³•**ï¼šåœ¨æ¨¡å—åŠ è½½æ—¶æ£€æŸ¥ç¯å¢ƒå˜é‡ï¼Œç¼ºå¤±åˆ™æŠ›å‡º Error

#### 3. å…¬å¼€ API Keyï¼ˆNEXT_PUBLIC_ å‰ç¼€ï¼‰
- **ä¸ºä»€ä¹ˆ**ï¼šSupabase çš„ anon key è®¾è®¡ä¸ºå®¢æˆ·ç«¯å¯ç”¨
- **å®‰å…¨ä¿è¯**ï¼š
  - RLSï¼ˆè¡Œçº§å®‰å…¨ï¼‰åœ¨æ•°æ®åº“å±‚ä¿æŠ¤æ•°æ®
  - Anon key æƒé™å—é™ï¼ˆåªèƒ½åšè®¤è¯å…è®¸çš„æ“ä½œï¼‰
  - ä¸åº”è¯¥åœ¨ç¯å¢ƒå˜é‡ä¸­å­˜æ”¾ service_role_keyï¼ˆè¿™ä¸ªè¦ä¿å¯†ï¼‰
- **å®ç°æ–¹æ³•**ï¼šä½¿ç”¨ NEXT_PUBLIC_ å‰ç¼€ï¼Œä½¿å…¶åœ¨å®¢æˆ·ç«¯ JavaScript ä¸­å¯è®¿é—®

### ä½¿ç”¨åœºæ™¯

#### åœºæ™¯ 1ï¼šåœ¨ API è·¯ç”±ä¸­æŸ¥è¯¢æ•°æ®
```typescript
// app/api/answers/route.ts
import { supabase } from "@/lib/supabase";

export async function POST(request: Request) {
  const { userId, questionId, answer } = await request.json();
  
  // ä½¿ç”¨ supabase å®¢æˆ·ç«¯æŸ¥è¯¢æˆ–æ’å…¥æ•°æ®
  const { data, error } = await supabase
    .from("user_progress")
    .insert({ user_id: userId, question_id: questionId, user_answer: answer });
  
  return Response.json({ success: !error });
}
```

#### åœºæ™¯ 2ï¼šåœ¨å®¢æˆ·ç«¯ç»„ä»¶ä¸­è·å–è®¤è¯ç”¨æˆ·
```typescript
// components/UserProfile.tsx
import { supabase } from "@/lib/supabase";

export function UserProfile() {
  const [user, setUser] = useState(null);
  
  useEffect(() => {
    supabase.auth.getUser().then(({ data }) => {
      setUser(data.user);
    });
  }, []);
  
  return <div>{user?.email}</div>;
}
```

#### åœºæ™¯ 3ï¼šç›‘å¬å®æ—¶æ•°æ®æ›´æ–°
```typescript
// Realtime subscription
const channel = supabase
  .channel('user-progress')
  .on('postgres_changes', 
    { event: 'INSERT', schema: 'public', table: 'user_progress' },
    (payload) => console.log('New progress:', payload)
  )
  .subscribe();
```

### ä¸ lib/types.ts çš„å…³è”

è™½ç„¶ `lib/supabase.ts` åªåˆ›å»ºå®¢æˆ·ç«¯ï¼Œä½†å®ƒä¸ `lib/types.ts` å¯†åˆ‡ç›¸å…³ï¼š

| æ–‡ä»¶ | èŒè´£ | å…³ç³» |
|-----|------|------|
| `lib/supabase.ts` | åˆ›å»ºæ•°æ®åº“è¿æ¥ | æä¾› Supabase æ“ä½œå…¥å£ |
| `lib/types.ts` | å®šä¹‰ TypeScript ç±»å‹ | ä¸º Supabase æ•°æ®å®šä¹‰ç»“æ„ |

**åä½œç¤ºä¾‹**ï¼š
```typescript
// å¯¼å…¥ç±»å‹å’Œå®¢æˆ·ç«¯
import { supabase } from "@/lib/supabase";
import type { Question, UserProgress } from "@/lib/types";

// æŸ¥è¯¢è¿”å› Question[] ç±»å‹
const { data: questions } = await supabase
  .from("questions")
  .select("*") as { data: Question[] };

// æ’å…¥ UserProgress ç±»å‹çš„æ•°æ®
await supabase.from("user_progress").insert(userProgress as UserProgress);
```

### ä¾èµ–å…³ç³»

| åº“ | ç”¨é€” | ç‰ˆæœ¬ |
|----|------|------|
| @supabase/supabase-js | æ ¸å¿ƒå®¢æˆ·ç«¯åº“ | ^2.0+ |

### åç»­æ‰©å±•ç‚¹

1. **æ·»åŠ ä¸­é—´ä»¶éªŒè¯**ï¼šå¦‚éœ€åœ¨æ¯æ¬¡è¯·æ±‚å‰éªŒè¯ç”¨æˆ·èº«ä»½
2. **é”™è¯¯å¤„ç†å°è£…**ï¼šåˆ›å»º `lib/supabaseHelper.ts` å°è£…å¸¸è§é”™è¯¯å¤„ç†
3. **ç¼“å­˜å±‚**ï¼šé›†æˆ SWR æˆ– React Query è¿›è¡Œå®¢æˆ·ç«¯ç¼“å­˜
4. **å®æ—¶æ•°æ®**ï¼šä½¿ç”¨ Supabase Realtime åŠŸèƒ½ç›‘å¬æ•°æ®å˜æ›´

### ä¸å…¶ä»– lib æ–‡ä»¶çš„åä½œæµç¨‹

```
ç”¨æˆ·è¯·æ±‚
    â†“
API Route (app/api/*/route.ts)
    â†“
[å¯¼å…¥ supabase å®¢æˆ·ç«¯] â†’ lib/supabase.ts
    â†“
[ä½¿ç”¨ç±»å‹è¿›è¡Œæ“ä½œ] â†’ lib/types.ts
    â†“
Supabase PostgreSQL æ•°æ®åº“
    â†“
è¿”å›å“åº”ç»™å®¢æˆ·ç«¯
```

### æ€»ç»“

`lib/supabase.ts` è™½ç„¶ä»£ç å¾ˆç®€æ´ï¼ˆä»… 12 è¡Œï¼‰ï¼Œä½†ä½œç”¨å…³é”®ï¼š
- å®ƒæ˜¯åº”ç”¨ä¸æ•°æ®åº“é€šä¿¡çš„å”¯ä¸€å…¥å£
- ç¡®ä¿å…¨å±€ä½¿ç”¨åŒä¸€ä¸ªè¿æ¥å®ä¾‹
- æä¾›ç±»å‹å®‰å…¨çš„åŸºç¡€ï¼ˆé…åˆ lib/types.tsï¼‰
- æ”¯æŒåç»­çš„è®¤è¯ã€RLSã€å®æ—¶æ•°æ®ç­‰é«˜çº§åŠŸèƒ½

æ­¤æ–‡ä»¶éœ€è¦åœ¨å…¶ä»–ä»»ä½• Supabase æ“ä½œä¹‹å‰åˆ›å»ºå’ŒéªŒè¯ã€‚

---

## æ­¥éª¤ 2.2ï¼šå…¨å±€ TypeScript ç±»å‹å®šä¹‰æ–‡ä»¶ - æ¶æ„æ´å¯Ÿ

### å®ç°ç›®çš„
å®šä¹‰åº”ç”¨èŒƒå›´å†…çš„æ‰€æœ‰æ•°æ®ç±»å‹ï¼Œæä¾›ç¼–è¯‘æ—¶çš„ç±»å‹æ£€æŸ¥ï¼Œç¡®ä¿ä»£ç ç±»å‹å®‰å…¨ï¼Œå¹¶ä¸ºå¼€å‘è€…æä¾›è‡ªåŠ¨å®Œæˆå’Œæ–‡æ¡£æ”¯æŒã€‚

### æ–‡ä»¶ç»“æ„

**æ–‡ä»¶ä½ç½®**: `lib/types.ts`

**æ ¸å¿ƒå†…å®¹**ï¼š8 ä¸ªæ¥å£ + å¤šä¸ª union types

```typescript
// ç”¨æˆ·ç›¸å…³
export interface Profile { ... }        // ç”¨æˆ·æ¡£æ¡ˆ
export interface AuthUser { ... }       // è®¤è¯ç”¨æˆ·

// é¢˜ç›®ç›¸å…³
export interface Question { ... }       // é¢˜ç›®æ•°æ®

// åšé¢˜ç›¸å…³
export interface UserProgress { ... }   // åšé¢˜ç»Ÿè®¡
export interface QuestionAttempt { ... }  // åšé¢˜å†å²

// åŠŸèƒ½ç›¸å…³
export interface Bookmark { ... }       // ä¹¦ç­¾
export interface FocusSession { ... }   // ç•ªèŒ„é’Ÿä¼šè¯

// API ç›¸å…³
export interface ApiResponse<T> { ... } // ç»Ÿä¸€å“åº”æ ¼å¼
```

### 8 ä¸ªæ ¸å¿ƒæ¥å£è¯¦è§£

#### 1. Profileï¼ˆç”¨æˆ·æ¡£æ¡ˆï¼‰
```typescript
interface Profile {
  id: string;                    // ç”¨æˆ· IDï¼ˆSupabase authï¼‰
  username: string;              // ç”¨æˆ·å
  level: number;                 // å½“å‰ç­‰çº§
  xp: number;                    // æ€»ç»éªŒå€¼
  streak_days: number;           // è¿ç»­ç­”å¯¹å¤©æ•°
  created_at: string;            // åˆ›å»ºæ—¶é—´
  updated_at: string;            // æ›´æ–°æ—¶é—´
}
```
**ç”¨é€”**: å­˜å‚¨ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯å’Œæ¸¸æˆåŒ–æ•°æ®ï¼ˆç­‰çº§ã€XPï¼‰
**æ›´æ–°åœºæ™¯**: ç”¨æˆ·å‡çº§ã€XP å¢åŠ ã€è¿å‡»è®¡æ•°æ—¶æ›´æ–°

#### 2. Questionï¼ˆé¢˜ç›®æ•°æ®ï¼‰
```typescript
interface Question {
  id: string;                    // é¢˜ç›® ID
  year: string;                  // å¹´ä»½ï¼ˆå¦‚ "2023"ï¼‰
  session: "AM" | "PM";          // ä¸Šåˆæˆ–ä¸‹åˆåœºæ¬¡
  category: string;              // ç±»åˆ«ï¼ˆå¦‚ "Fundamentals"ï¼‰
  question_number: number;       // é¢˜å·
  content: string;               // é¢˜å¹²
  option_a/b/c/d: string;       // å››ä¸ªé€‰é¡¹
  correct_answer: "A"|"B"|"C"|"D";  // æ­£ç¡®ç­”æ¡ˆ
  explanation: string;           // è§£æ
  difficulty: "easy"|"normal"|"hard";  // éš¾åº¦
  created_at: string;            // åˆ›å»ºæ—¶é—´
}
```
**ç”¨é€”**: å­˜å‚¨é¢˜åº“ä¸­çš„é¢˜ç›®ä¿¡æ¯
**ç‰¹ç‚¹**: ä¸å¯å˜ï¼ˆåç«¯åªè¯»ï¼Œå‰ç«¯ä¸ä¿®æ”¹ï¼‰
**æŸ¥è¯¢ä¼˜åŒ–**: year å’Œ category å­—æ®µæœ‰ç´¢å¼•

#### 3. UserProgressï¼ˆåšé¢˜ç»Ÿè®¡ï¼‰
```typescript
interface UserProgress {
  id: string;                         // è®°å½• ID
  user_id: string;                    // ç”¨æˆ· ID
  question_id: string;                // é¢˜ç›® ID
  user_answer: "A"|"B"|"C"|"D"|null;  // ç”¨æˆ·é€‰æ‹©çš„ç­”æ¡ˆ
  is_correct: boolean | null;         // æ˜¯å¦ç­”å¯¹ï¼ˆnull=æœªåšè¿‡ï¼‰
  attempt_count: number;              // åšè¿‡å‡ æ¬¡
  consecutive_correct_count: number;  // è¿ç»­ç­”å¯¹æ¬¡æ•°
  status: "normal"|"wrong_book"|"mastered";  // åšé¢˜çŠ¶æ€
  last_attempt_at: string | null;     // æœ€ååšé¢˜æ—¶é—´
  created_at: string;                 // åˆ›å»ºæ—¶é—´
}
```
**ç”¨é€”**: è¿½è¸ªå•é¢˜çš„åšé¢˜ç»Ÿè®¡
**æ ¸å¿ƒè®¾è®¡**: ä¸º user_id + question_id çš„å”¯ä¸€çº¦æŸï¼ˆæ¯é¢˜æœ€å¤šä¸€æ¡è®°å½•ï¼‰
**çŠ¶æ€æµè½¬**:
- normal â†’ æ­£å¸¸çŠ¶æ€ï¼ˆé¦–æ¬¡åšå¯¹ï¼‰
- normal â†’ wrong_book â†’ masteredï¼ˆç¬¬ä¸€æ¬¡åšé”™ï¼Œè¿ç»­ç­”å¯¹ 3 æ¬¡åå‡çº§ï¼‰
- wrong_bookï¼ˆåšé”™åè‡ªåŠ¨è®¾ç½®ï¼‰

#### 4. QuestionAttemptï¼ˆåšé¢˜å†å²ï¼‰
```typescript
interface QuestionAttempt {
  id: string;                         // è®°å½• ID
  user_id: string;                    // ç”¨æˆ· ID
  question_id: string;                // é¢˜ç›® ID
  user_answer: "A"|"B"|"C"|"D";       // æœ¬æ¬¡ç­”æ¡ˆ
  is_correct: boolean;                // æœ¬æ¬¡æ˜¯å¦ç­”å¯¹
  pomodoro_session_id: string | null; // æ‰€å±ç•ªèŒ„é’Ÿï¼ˆå¯é€‰ï¼‰
  created_at: string;                 // åšé¢˜æ—¶é—´æˆ³
}
```
**ç”¨é€”**: ä¿ç•™åšé¢˜çš„å®Œæ•´å†å²ï¼ˆä¸€æ¬¡åšé¢˜=ä¸€æ¡è®°å½•ï¼‰
**ä¸ UserProgress çš„åŒºåˆ«**:
- `UserProgress` æ˜¯ç»Ÿè®¡è¡¨ï¼ˆæ€»æ¬¡æ•°ã€è¿ç»­ç­”å¯¹æ•°ï¼‰
- `QuestionAttempt` æ˜¯å†å²è¡¨ï¼ˆæ¯ä¸€æ¬¡éƒ½è®°å½•ï¼‰
**åˆ†æç”¨é€”**: è¿½è¸ªå­¦ä¹ æ›²çº¿ã€å‘ç°å¼±ç‚¹ç­‰

#### 5. Bookmarkï¼ˆä¹¦ç­¾ï¼‰
```typescript
interface Bookmark {
  id: string;              // ä¹¦ç­¾ ID
  user_id: string;         // ç”¨æˆ· ID
  question_id: string;     // é¢˜ç›® ID
  created_at: string;      // åˆ›å»ºæ—¶é—´
}
```
**ç”¨é€”**: ç”¨æˆ·æ”¶è—é‡è¦é¢˜ç›®
**è®¾è®¡**: user_id + question_id å”¯ä¸€çº¦æŸï¼ˆé˜²é‡å¤æ”¶è—ï¼‰

#### 6. FocusSessionï¼ˆç•ªèŒ„é’Ÿä¼šè¯ï¼‰
```typescript
interface FocusSession {
  id: string;                  // ä¼šè¯ ID
  user_id: string;             // ç”¨æˆ· ID
  started_at: string;          // å¼€å§‹æ—¶é—´
  ended_at: string | null;     // ç»“æŸæ—¶é—´ï¼ˆè¿›è¡Œä¸­ä¸º nullï¼‰
  duration: number;            // å®é™…æ—¶é•¿ï¼ˆç§’ï¼‰
  goal_description: string | null;  // ç›®æ ‡æè¿°ï¼ˆå¯é€‰ï¼‰
  created_at: string;          // åˆ›å»ºæ—¶é—´
}
```
**ç”¨é€”**: è®°å½•ç•ªèŒ„é’Ÿä¼šè¯ï¼Œæ”¯æŒå­¦ä¹ æ—¶é—´ç»Ÿè®¡

#### 7. ApiResponseï¼ˆAPI å“åº”ï¼‰
```typescript
interface ApiResponse<T> {
  success: boolean;     // æ˜¯å¦æˆåŠŸ
  data?: T;            // æˆåŠŸæ—¶çš„æ•°æ®
  error?: string;      // å¤±è´¥æ—¶çš„é”™è¯¯æ¶ˆæ¯
}
```
**ç”¨é€”**: ç»Ÿä¸€æ‰€æœ‰ API ç«¯ç‚¹çš„å“åº”æ ¼å¼
**æ³›å‹è®¾è®¡**: `ApiResponse<Question[]>` è¡¨ç¤ºè¿”å›é¢˜ç›®æ•°ç»„

#### 8. AuthUserï¼ˆè®¤è¯ç”¨æˆ·ï¼‰
```typescript
interface AuthUser {
  id: string;     // ç”¨æˆ· IDï¼ˆæ¥è‡ª Supabase Authï¼‰
  email: string;  // é‚®ç®±
}
```
**ç”¨é€”**: å­˜å‚¨ä» Supabase Auth è·å–çš„ç”¨æˆ·ä¿¡æ¯ï¼ˆæœ€å°é›†ï¼‰

### Union Types è®¾è®¡

#### 1. Session - è€ƒè¯•åœºæ¬¡
```typescript
session: "AM" | "PM"
```
**å«ä¹‰**:
- "AM" - ä¸Šåˆåœº
- "PM" - ä¸‹åˆåœº
**åº”ç”¨**: FE å’Œ AP è€ƒè¯•é€šå¸¸æœ‰ä¸¤ä¸ªæ—¶é—´æ®µ

#### 2. Difficulty - éš¾åº¦çº§åˆ«
```typescript
difficulty: "easy" | "normal" | "hard"
```
**å«ä¹‰**:
- "easy" - ç®€å•ï¼ˆåŸºç¡€æ¦‚å¿µï¼‰
- "normal" - ä¸­ç­‰ï¼ˆæ ‡å‡†éš¾åº¦ï¼‰
- "hard" - å›°éš¾ï¼ˆé«˜é˜¶åº”ç”¨ï¼‰
**åº”ç”¨**: ç”¨äºé¢˜ç›®ç­›é€‰ã€éš¾åº¦ç»Ÿè®¡

#### 3. Status - åšé¢˜çŠ¶æ€
```typescript
status: "normal" | "wrong_book" | "mastered"
```
**å«ä¹‰**:
- "normal" - æ™®é€šçŠ¶æ€ï¼ˆåšå¯¹è¿‡æˆ–æœªåšè¿‡ï¼‰
- "wrong_book" - é”™é¢˜çŠ¶æ€ï¼ˆåšé”™è¿‡ï¼‰
- "mastered" - å·²æŒæ¡ï¼ˆè¿ç»­ç­”å¯¹ 3 æ¬¡ï¼‰
**çŠ¶æ€è½¬ç§»å›¾**:
```
åˆå§‹ï¼ˆæœªåšï¼‰ â†’ normalï¼ˆç­”å¯¹ï¼‰
            â†’ wrong_bookï¼ˆç­”é”™ï¼‰
                    â†“
                  masteredï¼ˆè¿ç»­ç­”å¯¹ 3 æ¬¡ï¼‰
```

#### 4. Answer - é€‰æ‹©ç­”æ¡ˆ
```typescript
answer: "A" | "B" | "C" | "D"
```
**å«ä¹‰**: å››é€‰ä¸€çš„é€‰æ‹©ç­”æ¡ˆ
**åº”ç”¨**: user_answerã€correct_answer å­—æ®µ

### å…³é”®è®¾è®¡åŸåˆ™

#### åŸåˆ™ 1ï¼šnull å€¼çš„è°¨æ…ä½¿ç”¨
```typescript
// âœ“ å¥½çš„åšæ³•ï¼šåŒºåˆ†"æœªçŸ¥"å’Œ"å·²ç¡®å®š"
user_answer: "A" | "B" | "C" | "D" | null;  // null = æœªåšè¿‡
is_correct: boolean | null;                  // null = æœªåšè¿‡
ended_at: string | null;                     // null = è¿›è¡Œä¸­

// âœ— é¿å…ï¼šè¿‡åº¦ä½¿ç”¨ null
username?: string;  // ä¸å¥½ï¼šåº”è¯¥æ€»æ˜¯æœ‰ç”¨æˆ·å
```

#### åŸåˆ™ 2ï¼šEnum vs Union Types
```typescript
// âœ“ æ¨èï¼šUnion typesï¼ˆç®€æ´ï¼Œæ— é¢å¤–ç¼–è¯‘ï¼‰
type Difficulty = "easy" | "normal" | "hard";

// âš ï¸ å¯ç”¨ä½†ä¸æ¨èï¼šEnumï¼ˆå¢åŠ ç¼–è¯‘äº§ç‰©ï¼‰
enum Difficulty {
  Easy = "easy",
  Normal = "normal",
  Hard = "hard"
}
```

#### åŸåˆ™ 3ï¼šå”¯ä¸€çº¦æŸçš„è®¾è®¡
```typescript
// UserProgress: user_id + question_id å”¯ä¸€
// å«ä¹‰ï¼šæ¯ä¸ªç”¨æˆ·å¯¹æ¯é¢˜æœ€å¤šæœ‰ä¸€æ¡ç»Ÿè®¡è®°å½•

// Bookmark: user_id + question_id å”¯ä¸€
// å«ä¹‰ï¼šæ¯ä¸ªç”¨æˆ·å¯¹æ¯é¢˜æœ€å¤šæ”¶è—ä¸€æ¬¡
```

### ä¸ lib/supabase.ts çš„é…åˆ

**åä½œæµç¨‹**:

```
API ç«¯ç‚¹ (app/api/*/route.ts)
    â†“
å¯¼å…¥ supabase å®¢æˆ·ç«¯
import { supabase } from "@/lib/supabase"
    â†“
å¯¼å…¥ç±»å‹å®šä¹‰
import type { Question, UserProgress } from "@/lib/types"
    â†“
æ‰§è¡Œç±»å‹åŒ–æ“ä½œ
const { data } = await supabase
  .from("questions")
  .select("*") as { data: Question[] }
    â†“
è¿”å› ApiResponse<T> æ ¼å¼çš„å“åº”
```

**ä¼˜åŠ¿**:
- ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥ï¼šcatch é”™è¯¯äºæ„å»ºé˜¶æ®µ
- è‡ªåŠ¨å®Œæˆï¼šIDE çŸ¥é“æ¯ä¸ªå­—æ®µçš„ç±»å‹
- æ–‡æ¡£åŒ–ï¼šç±»å‹å°±æ˜¯æœ€å¥½çš„æ–‡æ¡£
- å¯ç»´æŠ¤æ€§ï¼šä¿®æ”¹æ•°æ®ç»“æ„æ—¶ï¼ŒTypeScript ä¼šæŒ‡å‡ºæ‰€æœ‰å½±å“çš„åœ°æ–¹

### ä¸æ•°æ®åº“è¡¨çš„æ˜ å°„å…³ç³»

| TypeScript Interface | Supabase Table | è¯´æ˜ |
|---------------------|----------------|------|
| Profile | profiles | 1:1 æ˜ å°„ |
| Question | questions | 1:1 æ˜ å°„ |
| UserProgress | user_progress | 1:1 æ˜ å°„ |
| QuestionAttempt | question_attempts | 1:1 æ˜ å°„ |
| Bookmark | bookmarks | 1:1 æ˜ å°„ |
| FocusSession | focus_sessions | 1:1 æ˜ å°„ |

### åç»­æ‰©å±•åœºæ™¯

#### åœºæ™¯ 1ï¼šæ·»åŠ æ–°å­—æ®µ
```typescript
// éœ€æ±‚ï¼šç”¨æˆ·æƒ³åœ¨é”™é¢˜æœ¬ä¸­æ·»åŠ ç¬”è®°
// ä¿®æ”¹ï¼šUserProgress æ¥å£
interface UserProgress {
  // ... ç°æœ‰å­—æ®µ
  notes?: string;  // æ–°å¢ï¼šç¬”è®°å­—æ®µ
}
// ç„¶ååœ¨ Supabase ä¸­ä¹Ÿæ·»åŠ å¯¹åº”å­—æ®µ
```

#### åœºæ™¯ 2ï¼šæ”¯æŒ AP è€ƒè¯•
```typescript
// éœ€æ±‚ï¼šåŒºåˆ† FE å’Œ AP è€ƒè¯•
// ä¿®æ”¹ï¼šQuestion æ¥å£
interface Question {
  // ... ç°æœ‰å­—æ®µ
  exam_type: "FE" | "AP";  // æ–°å¢ï¼šè€ƒè¯•ç±»å‹
}
// æ‰€æœ‰æŸ¥è¯¢éƒ½éœ€è¦åŠ ä¸Š exam_type è¿‡æ»¤
```

#### åœºæ™¯ 3ï¼šæ·»åŠ ç”¨æˆ·æˆå°±ç³»ç»Ÿ
```typescript
// æ–°å¢ï¼šAchievement æ¥å£
interface Achievement {
  id: string;
  user_id: string;
  title: string;
  description: string;
  icon_url: string;
  unlocked_at: string | null;  // null = æœªè§£é”
}

// æ–°å¢ï¼šAchievementProgress æ¥å£
interface AchievementProgress {
  id: string;
  user_id: string;
  achievement_id: string;
  progress: number;           // 0-100
  status: "locked" | "in_progress" | "unlocked";
}
```

### æ€§èƒ½è€ƒè™‘

#### é—®é¢˜ 1ï¼šä¸ºä»€ä¹ˆ Question æ˜¯ä¸å¯å˜çš„ï¼Ÿ
- é¢˜ç›®ä¿¡æ¯ä¸€æ—¦å‘å¸ƒä¸åº”æ”¹å˜ï¼ˆç¡®ä¿å…¬å¹³æ€§ï¼‰
- å‡å°‘æ•°æ®åº“æŸ¥è¯¢å‹åŠ›
- å¯ä»¥å……åˆ†ç¼“å­˜

#### é—®é¢˜ 2ï¼šä¸ºä»€ä¹ˆéœ€è¦ä¸¤å¼ è¡¨ï¼ˆUserProgress å’Œ QuestionAttemptï¼‰ï¼Ÿ
- UserProgressï¼šç»Ÿè®¡æ•°æ®ï¼ˆå½“å‰çŠ¶æ€ï¼‰â€” é¢‘ç¹æ›´æ–°ï¼ŒæŸ¥è¯¢å¿«
- QuestionAttemptï¼šå†å²æ•°æ®ï¼ˆå®Œæ•´è®°å½•ï¼‰â€” ä»…è¿½åŠ ï¼Œç”¨äºåˆ†æ

#### é—®é¢˜ 3ï¼šuser_answer å’Œ is_correct ä¸ºä»€ä¹ˆæœ‰ nullï¼Ÿ
- null = ç”¨æˆ·ä»æœªåšè¿‡è¿™é“é¢˜
- åŒºåˆ†"ä¸çŸ¥é“ç”¨æˆ·æ˜¯å¦åšè¿‡"vs"ç”¨æˆ·åšè¿‡ä½†ç­”æ¡ˆæ˜¯ null"ï¼ˆå®é™…ä¸Šä¸å¯èƒ½ï¼‰

### æ€»ç»“

`lib/types.ts` è™½ç„¶åªæ˜¯ç±»å‹å®šä¹‰æ–‡ä»¶ï¼Œä½†å®ƒï¼š
- **å®šä¹‰äº†åº”ç”¨çš„æ•°æ®å¥‘çº¦**ï¼šæ‰€æœ‰æ“ä½œéƒ½åŸºäºè¿™äº›ç±»å‹
- **æä¾›äº†ç¼–è¯‘æ—¶å®‰å…¨**ï¼šTypeScript åœ¨æ„å»ºæ—¶å°±èƒ½å‘ç°ç±»å‹é”™è¯¯
- **æ–‡æ¡£åŒ–äº†æ•°æ®ç»“æ„**ï¼šæ–°å¼€å‘è€…å¯ä»¥é€šè¿‡ç±»å‹å®šä¹‰å¿«é€Ÿç†è§£åº”ç”¨
- **æ”¯æŒåç»­æ‰©å±•**ï¼šæ–°å¢åŠŸèƒ½æ—¶åªéœ€ä¿®æ”¹å¯¹åº”çš„æ¥å£

ä¸ `lib/supabase.ts` ä¸€èµ·ï¼Œ`lib/types.ts` å½¢æˆäº†ç±»å‹å®‰å…¨çš„ Supabase é›†æˆå±‚ã€‚

---

## æ­¥éª¤ 2.3ï¼šå¯¼å…¥ç¤ºä¾‹é¢˜ç›®æ•°æ®åˆ° Supabase - æ¶æ„æ´å¯Ÿ

### å®ç°ç›®çš„
å°†å‡†å¤‡å¥½çš„é¢˜ç›®æ•°æ®å¯¼å…¥ Supabase æ•°æ®åº“çš„ `questions` è¡¨ï¼Œä¸ºåº”ç”¨æä¾›åˆå§‹é¢˜åº“æ•°æ®ï¼Œæ”¯æŒåç»­çš„é¢˜åº“æµè§ˆå’Œåšé¢˜åŠŸèƒ½ã€‚

### æ•°æ®å¯¼å…¥æµç¨‹

#### æ•°æ®ç»“æ„ï¼ˆQuestion Interfaceï¼‰
```typescript
interface Question {
  id: string;              // å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆSupabase è‡ªåŠ¨ç”Ÿæˆï¼‰
  year: string;            // å¹´ä»½ï¼ˆå¦‚ "2023"ï¼‰
  session: "AM" | "PM";    // è€ƒè¯•åœºæ¬¡
  category: string;        // ç±»åˆ«ï¼ˆå¦‚ "Fundamentals", "Data Structures"ï¼‰
  question_number: number; // é¢˜å·
  content: string;         // é¢˜å¹²å†…å®¹
  option_a: string;        // é€‰é¡¹ A
  option_b: string;        // é€‰é¡¹ B
  option_c: string;        // é€‰é¡¹ C
  option_d: string;        // é€‰é¡¹ D
  correct_answer: "A"|"B"|"C"|"D";  // æ­£ç¡®ç­”æ¡ˆ
  explanation: string;     // è§£æè¯´æ˜
  difficulty: "easy"|"normal"|"hard";  // éš¾åº¦çº§åˆ«
  created_at: string;      // åˆ›å»ºæ—¶é—´æˆ³
}
```

### å¯¼å…¥æ–¹æ³•å¯¹æ¯”

#### æ–¹æ³• 1ï¼šSupabase Dashboard Table Editorï¼ˆæ¨èç”¨äºå°è§„æ¨¡æ•°æ®ï¼‰
**æ­¥éª¤**ï¼š
1. ç™»å½• Supabase Dashboard
2. é€‰æ‹©é¡¹ç›® â†’ è¿›å…¥ Tables
3. æ‰¾åˆ° `questions` è¡¨
4. ç‚¹å‡» "Insert" â†’ "Import from CSV"
5. ä¸Šä¼ æˆ–ç²˜è´´ CSV/JSON æ•°æ®
6. éªŒè¯å­—æ®µæ˜ å°„æ­£ç¡®
7. ç¡®è®¤å¯¼å…¥

**ä¼˜åŠ¿**ï¼š
- âœ“ æ— éœ€ç¼–ç 
- âœ“ å¯è§†åŒ–éªŒè¯
- âœ“ å®æ—¶é¢„è§ˆ

**åŠ£åŠ¿**ï¼š
- å¤§é‡æ•°æ®æ—¶è¾ƒæ…¢
- éœ€è¦æ‰‹åŠ¨æ“ä½œ

**é€‚ç”¨åœºæ™¯**ï¼šåˆå§‹é¢˜åº“å¯¼å…¥ï¼ˆ20-500 æ¡è®°å½•ï¼‰

#### æ–¹æ³• 2ï¼šSQL INSERT è¯­å¥ï¼ˆæ¨èç”¨äºä¸­ç­‰è§„æ¨¡æ•°æ®ï¼‰
**SQL ç¤ºä¾‹**ï¼š
```sql
INSERT INTO questions (year, session, category, question_number, content, option_a, option_b, option_c, option_d, correct_answer, explanation, difficulty)
VALUES 
  ('2023', 'AM', 'Fundamentals', 1, 'é¢˜å¹²å†…å®¹...', 'é€‰é¡¹A', 'é€‰é¡¹B', 'é€‰é¡¹C', 'é€‰é¡¹D', 'A', 'è§£æ...', 'easy'),
  ('2023', 'AM', 'Fundamentals', 2, 'é¢˜å¹²å†…å®¹...', 'é€‰é¡¹A', 'é€‰é¡¹B', 'é€‰é¡¹C', 'é€‰é¡¹D', 'B', 'è§£æ...', 'normal'),
  ...
```

**ä¼˜åŠ¿**ï¼š
- âœ“ å¯æ‰¹é‡æ’å…¥
- âœ“ å¯æ§åˆ¶é¡ºåº
- âœ“ æ˜“äºç‰ˆæœ¬æ§åˆ¶

**åŠ£åŠ¿**ï¼š
- éœ€è¦æ‰‹å†™ SQL
- æ•°æ®é‡å¤§æ—¶æ€§èƒ½è¾ƒå·®

**é€‚ç”¨åœºæ™¯**ï¼šä¸­ç­‰è§„æ¨¡æ•°æ®æˆ–æœ‰ç‰¹å®šé¡ºåºè¦æ±‚

#### æ–¹æ³• 3ï¼šSupabase API + è„šæœ¬ï¼ˆæ¨èç”¨äºå¤§è§„æ¨¡æ•°æ®ï¼‰
**ä»£ç ç¤ºä¾‹**ï¼š
```typescript
import { supabase } from "@/lib/supabase";
import type { Question } from "@/lib/types";

const questionsData: Question[] = [
  // ä» JSON æ–‡ä»¶æˆ– API è¯»å–
];

// æ‰¹é‡å¯¼å…¥
const { data, error } = await supabase
  .from("questions")
  .insert(questionsData);

if (error) {
  console.error("Import failed:", error);
} else {
  console.log("Imported", data?.length, "questions");
}
```

**ä¼˜åŠ¿**ï¼š
- âœ“ å¯è‡ªåŠ¨åŒ–
- âœ“ æ˜“äºå¤„ç†é”™è¯¯
- âœ“ æ”¯æŒå¤§è§„æ¨¡æ•°æ®
- âœ“ å¯é›†æˆåˆ°éƒ¨ç½²æµç¨‹

**åŠ£åŠ¿**ï¼š
- éœ€è¦ç¼–å†™ä»£ç 
- éœ€è¦è®¾ç½®ç¯å¢ƒ

**é€‚ç”¨åœºæ™¯**ï¼šå¤§è§„æ¨¡æ•°æ®ï¼ˆ1000+ æ¡ï¼‰æˆ–è‡ªåŠ¨åŒ–å¯¼å…¥

### æœ¬é¡¹ç›®é‡‡ç”¨çš„æ–¹æ³•

**é€‰æ‹©**ï¼šæ–¹æ³• 1ï¼ˆSupabase Dashboard Table Editorï¼‰

**åŸå› **ï¼š
- åˆæœŸæ•°æ®é‡è¾ƒå°ï¼ˆ20+ æ¡ï¼‰
- ä¾¿äºéªŒè¯æ•°æ®å®Œæ•´æ€§
- æ— éœ€ç¼–ç ï¼Œå¿«é€Ÿä¸Šæ‰‹
- å¯è§†åŒ–æ“ä½œå‡å°‘é”™è¯¯

### æ•°æ®å®Œæ•´æ€§ä¿è¯

#### 1. å­—æ®µæ˜ å°„éªŒè¯
å¯¼å…¥æ—¶éœ€ç¡®ä¿ä»¥ä¸‹å­—æ®µæ­£ç¡®æ˜ å°„ï¼š
```
CSV/JSON å­—æ®µ      â†’ Supabase è¡¨å­—æ®µ
year               â†’ year
session            â†’ session (AM æˆ– PM)
category           â†’ category
question_number    â†’ question_number
content            â†’ content
option_a/b/c/d     â†’ option_a/b/c/d
correct_answer     â†’ correct_answer (A/B/C/D)
explanation        â†’ explanation
difficulty         â†’ difficulty (easy/normal/hard)
```

#### 2. æ•°æ®ç±»å‹æ£€æŸ¥
```typescript
// âœ“ æ­£ç¡®çš„æ•°æ®ç±»å‹
{
  year: "2023",              // string
  session: "AM",             // "AM" | "PM"
  category: "Fundamentals",  // string
  question_number: 1,        // number
  content: "é¢˜å¹²...",        // string
  option_a: "é€‰é¡¹A",         // string
  correct_answer: "A",       // "A" | "B" | "C" | "D"
  difficulty: "easy"         // "easy" | "normal" | "hard"
}
```

#### 3. å¿…å¡«å­—æ®µæ£€æŸ¥
æ‰€æœ‰ä»¥ä¸‹å­—æ®µå¿…é¡»æœ‰å€¼ï¼ˆä¸èƒ½ä¸º NULLï¼‰ï¼š
- âœ“ year
- âœ“ session
- âœ“ category
- âœ“ question_number
- âœ“ contentï¼ˆé¢˜å¹²ï¼‰
- âœ“ option_a, option_b, option_c, option_dï¼ˆå››ä¸ªé€‰é¡¹ï¼‰
- âœ“ correct_answer
- âœ“ explanation
- âœ“ difficulty

#### 4. å”¯ä¸€æ€§æ£€æŸ¥
```sql
-- éªŒè¯æ˜¯å¦æœ‰é‡å¤çš„é¢˜ç›®
SELECT year, session, category, question_number, COUNT(*) 
FROM questions 
GROUP BY year, session, category, question_number 
HAVING COUNT(*) > 1;

-- æ­£å¸¸æƒ…å†µä¸‹åº”è¯¥è¿”å› 0 è¡Œ
```

### éªŒè¯æŸ¥è¯¢

#### éªŒè¯ 1ï¼šæ€»è®°å½•æ•°
```sql
SELECT COUNT(*) as total_questions FROM questions;
-- æœŸæœ›ï¼šâ‰¥ 20
```

#### éªŒè¯ 2ï¼šå¹´ä»½å¤šæ ·æ€§
```sql
SELECT DISTINCT year FROM questions ORDER BY year;
-- æœŸæœ›ï¼šâ‰¥ 2 ä¸ªå¹´ä»½
```

#### éªŒè¯ 3ï¼šç±»åˆ«å¤šæ ·æ€§
```sql
SELECT DISTINCT category FROM questions ORDER BY category;
-- æœŸæœ›ï¼šâ‰¥ 3 ä¸ªç±»åˆ«
```

#### éªŒè¯ 4ï¼šéš¾åº¦åˆ†å¸ƒ
```sql
SELECT difficulty, COUNT(*) as count 
FROM questions 
GROUP BY difficulty 
ORDER BY difficulty;
-- æœŸæœ›ï¼šè‡³å°‘åŒ…å« easy, normal, hard ä¸‰ä¸ªéš¾åº¦
```

#### éªŒè¯ 5ï¼šå­—æ®µå®Œæ•´æ€§
```sql
SELECT COUNT(*) as null_content FROM questions WHERE content IS NULL;
SELECT COUNT(*) as null_answer FROM questions WHERE correct_answer IS NULL;
-- æœŸæœ›ï¼šéƒ½è¿”å› 0
```

### æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–

#### ç´¢å¼•è®¾è®¡
æ ¹æ®å¸¸è§æŸ¥è¯¢æ¨¡å¼ï¼Œä»¥ä¸‹å­—æ®µå·²æœ‰ç´¢å¼•ï¼š
```sql
-- å·²åˆ›å»ºçš„ç´¢å¼•
CREATE INDEX idx_questions_year ON questions(year);
CREATE INDEX idx_questions_category ON questions(category);
CREATE INDEX idx_questions_year_category ON questions(year, category);
```

**ä¼˜åŒ–è¯´æ˜**ï¼š
- ç”¨æˆ·æŒ‰å¹´ä»½ç­›é€‰é¢˜ç›® â†’ ä½¿ç”¨ `year` ç´¢å¼•
- ç”¨æˆ·æŒ‰ç±»åˆ«ç­›é€‰é¢˜ç›® â†’ ä½¿ç”¨ `category` ç´¢å¼•
- ç”¨æˆ·åŒæ—¶æŒ‰å¹´ä»½å’Œç±»åˆ«ç­›é€‰ â†’ ä½¿ç”¨ç»„åˆç´¢å¼•

#### æŸ¥è¯¢æ€§èƒ½ç¤ºä¾‹
```typescript
// å¿«é€ŸæŸ¥è¯¢ç¤ºä¾‹ï¼ˆä¼šä½¿ç”¨ç´¢å¼•ï¼‰
const questions = await supabase
  .from("questions")
  .select("*")
  .eq("year", "2023")
  .eq("category", "Fundamentals");

// æ…¢æŸ¥è¯¢ç¤ºä¾‹ï¼ˆä¸ä¼šä½¿ç”¨ç´¢å¼•ï¼‰
const questions = await supabase
  .from("questions")
  .select("*")
  .textSearch("content", "å…³é”®è¯"); // å…¨æ–‡æœç´¢
```

### ä¸ç±»å‹ç³»ç»Ÿçš„åä½œ

**å®Œæ•´çš„æ•°æ®æµ**ï¼š

```
å¯¼å…¥æ•°æ® (CSV/JSON)
    â†“
Supabase æ•°æ®åº“ (questions è¡¨)
    â†“
Supabase API æŸ¥è¯¢
    â†“
å‰ç«¯æ¥æ”¶ JSON å“åº”
    â†“
TypeScript ç±»å‹æ£€æŸ¥ (Question interface)
    â†“
IDE è‡ªåŠ¨å®Œæˆå’Œç±»å‹æç¤º
```

**ç¤ºä¾‹ä»£ç **ï¼š
```typescript
// API ç«¯ç‚¹ï¼ˆapp/api/questions/route.tsï¼‰
import { supabase } from "@/lib/supabase";
import type { Question } from "@/lib/types";

export async function GET(request: Request) {
  const { searchParams } = new URL(request.url);
  const year = searchParams.get("year");
  const category = searchParams.get("category");

  let query = supabase
    .from("questions")
    .select("*");

  if (year) query = query.eq("year", year);
  if (category) query = query.eq("category", category);

  const { data, error } = await query;

  if (error) {
    return Response.json({ success: false, error: error.message });
  }

  // data è‡ªåŠ¨è¢« TypeScript æ¨æ–­ä¸º Question[]
  return Response.json({ success: true, data });
}
```

### åç»­æ•°æ®ç»´æŠ¤

#### åœºæ™¯ 1ï¼šæ·»åŠ æ–°é¢˜ç›®
```sql
-- å•æ¡æ’å…¥
INSERT INTO questions (year, session, category, question_number, content, option_a, option_b, option_c, option_d, correct_answer, explanation, difficulty)
VALUES ('2024', 'AM', 'Fundamentals', 21, 'æ–°é¢˜å¹²...', '...', '...', '...', '...', 'A', '...', 'normal');

-- æ‰¹é‡æ’å…¥
INSERT INTO questions (...) VALUES (...), (...), ...;
```

#### åœºæ™¯ 2ï¼šæ›´æ–°é¢˜ç›®
```sql
-- ä¿®æ­£é”™è¯¯é¢˜ç›®
UPDATE questions 
SET content = 'ä¿®æ­£åçš„é¢˜å¹²', explanation = 'ä¿®æ­£åçš„è§£æ'
WHERE year = '2023' AND question_number = 5;
```

#### åœºæ™¯ 3ï¼šåˆ é™¤é¢˜ç›®
```sql
-- è°¨æ…ä½¿ç”¨ï¼ˆä¼šå½±å“å·²æœ‰çš„åšé¢˜è®°å½•ï¼‰
DELETE FROM questions 
WHERE year = '2022' AND question_number = 1;
```

**å»ºè®®**ï¼š
- ä½¿ç”¨è½¯åˆ é™¤ï¼ˆæ·»åŠ  `is_deleted` å­—æ®µï¼‰
- ä¿æŒå†å²è®°å½•å®Œæ•´æ€§
- é¿å…ç›´æ¥åˆ é™¤å·²æœ‰åšé¢˜è®°å½•çš„é¢˜ç›®

#### åœºæ™¯ 4ï¼šå¯¼å‡ºé¢˜ç›®å¤‡ä»½
```sql
-- å¯¼å‡ºä¸º CSV
SELECT year, session, category, question_number, content, 
       option_a, option_b, option_c, option_d, 
       correct_answer, explanation, difficulty
FROM questions
ORDER BY year, question_number;
```

### æ€§èƒ½è€ƒè™‘

#### é—®é¢˜ 1ï¼šå¯¼å…¥æ—¶æ€§èƒ½
- å¯¼å…¥ 20 æ¡è®°å½•ï¼šæ¯«ç§’çº§ï¼ˆæ— æ˜æ˜¾æ„ŸçŸ¥ï¼‰
- å¯¼å…¥ 1000 æ¡è®°å½•ï¼šç§’çº§ï¼ˆå¯èƒ½éœ€è¦ç­‰å¾…ï¼‰
- å¯¼å…¥ 10000+ æ¡ï¼šåˆ†é’Ÿçº§ï¼ˆå»ºè®®ä½¿ç”¨ API è„šæœ¬åˆ†æ‰¹å¯¼å…¥ï¼‰

#### é—®é¢˜ 2ï¼šæŸ¥è¯¢æ—¶æ€§èƒ½
```typescript
// âœ“ å¿«é€Ÿï¼ˆä½¿ç”¨ç´¢å¼•ï¼‰
.eq("year", "2023")
.eq("category", "Fundamentals")

// âš ï¸ è¾ƒæ…¢ï¼ˆå…¨è¡¨æ‰«æï¼‰
.like("content", "%å…³é”®è¯%")

// âŒ å¾ˆæ…¢ï¼ˆå¤æ‚é€»è¾‘ï¼‰
.select("*", { count: "exact" })  // è®¡æ•°æ‰€æœ‰è¡Œ
```

### æ€»ç»“

`questions` è¡¨çš„æ•°æ®å¯¼å…¥æ˜¯åº”ç”¨çš„åŸºç¡€ï¼Œç›´æ¥å½±å“ï¼š
- **ç”¨æˆ·ä½“éªŒ**ï¼šé¢˜åº“æ•°é‡å’Œè´¨é‡å†³å®šå­¦ä¹ ä½“éªŒ
- **ç³»ç»Ÿæ€§èƒ½**ï¼šç´¢å¼•è®¾è®¡å½±å“æŸ¥è¯¢é€Ÿåº¦
- **æ•°æ®å®Œæ•´æ€§**ï¼šå­—æ®µå®Œæ•´æ€§å½±å“åç»­åŠŸèƒ½ï¼ˆåšé¢˜ã€ç»Ÿè®¡ç­‰ï¼‰
- **å¯ç»´æŠ¤æ€§**ï¼šæ¸…æ™°çš„æ•°æ®ç»“æ„ä¾¿äºæœªæ¥æ‰©å±•

é€šè¿‡æ­£ç¡®çš„å¯¼å…¥æ–¹æ³•ã€å®Œæ•´çš„éªŒè¯å’Œåˆç†çš„ç´¢å¼•è®¾è®¡ï¼Œæˆ‘ä»¬ä¸ºåç»­çš„æ ¸å¿ƒåŠŸèƒ½å¥ å®šäº†åšå®åŸºç¡€ã€‚
---

## ²½Öè 2.4£º´´½¨µÇÂ¼Ò³Ãæ - ¼Ü¹¹¶´²ì

### ÊµÏÖÄ¿µÄ
´´½¨Ò»¸öÃÀ¹Û¡¢ÏìÓ¦Ê½µÄµÇÂ¼Ò³Ãæ£¬×÷ÎªÓÃ»§½øÈëÓ¦ÓÃµÄÈë¿Ú¡£¸ÃÒ³ÃæÌá¹©ÓÊÏäºÍ GitHub Á½ÖÖµÇÂ¼·½Ê½£¬²¢Òıµ¼ĞÂÓÃ»§µ½×¢²áÒ³Ãæ¡£

### ÎÄ¼ş½á¹¹

**ÎÄ¼şÎ»ÖÃ**: pp/(auth)/login/page.tsx

**ºËĞÄÄÚÈİ**:
`	ypescript
// 1. µ¼Èë React ºÍ Next.js µÄ Link ×é¼ş
import Link from "next/link";

// 2. µ¼Èë shadcn/ui ×é¼ş
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";

// 3. ¶¨Òå LoginPage ×é¼ş
export default function LoginPage() {
  return (
    // Ê¹ÓÃ Flexbox ºÍ Tailwind CSS ÊµÏÖ¾ÓÖĞ²¼¾Ö
    <div className="flex items-center justify-center min-h-screen ...">
      <Card>
        <CardHeader>
          <CardTitle>µÇÂ¼</CardTitle>
          <CardDescription>...</CardDescription>
        </CardHeader>
        <CardContent>
          {/* µÇÂ¼±íµ¥ */}
          <div className="grid gap-4">
            <Label htmlFor="email">ÓÊÏä</Label>
            <Input id="email" type="email" ... />
            
            <Label htmlFor="password">ÃÜÂë</Label>
            <Input id="password" type="password" ... />

            <Button type="submit" className="w-full ...">ÓÊÏäµÇÂ¼</Button>
            <Button variant="secondary" className="w-full ...">GitHub µÇÂ¼</Button>
          </div>
          
          {/* ×¢²áÁ´½Ó */}
          <div className="mt-4 text-center text-sm">
            »¹Ã»ÓĞÕË»§? <Link href="/register">×¢²á</Link>
          </div>
        </CardContent>
      </Card>
    </div>
  );
}
`

### ¹Ø¼üÉè¼Æ¾ö²ß

#### 1. Â·ÓÉ·Ö×é (auth)
- **ÎªÊ²Ã´**: (auth) ÎÄ¼ş¼ĞÊÇÒ»¸öÂ·ÓÉ×é£¬Ëü²»»áÓ°Ïì URL Â·¾¶£¨¼´ URL ÈÔÈ»ÊÇ /login ¶ø²»ÊÇ /(auth)/login£©¡£
- **ºÃ´¦**:
  - **×éÖ¯ĞÔ**: ½«ËùÓĞÈÏÖ¤Ïà¹ØµÄÒ³Ãæ£¨ÈçµÇÂ¼¡¢×¢²á¡¢Íü¼ÇÃÜÂë£©·ÅÔÚÒ»Æğ£¬±ãÓÚ¹ÜÀí¡£
  - **¹²Ïí²¼¾Ö**: ¿ÉÒÔÎªÕâ¸ö×é´´½¨Ò»¸öpp/(auth)/layout.tsxÎÄ¼ş£¬ÎªËùÓĞÈÏÖ¤Ò³ÃæÌá¹©Í³Ò»µÄ²¼¾Ö£¬¶ø²»»áÓ°Ïìµ½ÒÇ±í°å£¨dashboard£©µÈÆäËû²¿·ÖµÄ²¼¾Ö¡£

#### 2. Ê¹ÓÃ shadcn/ui ¹¹½¨±íµ¥
- **ÎªÊ²Ã´**: shadcn/ui Ìá¹©ÁËÒ»Ì×Éè¼Æ¾«Á¼¡¢¿É·ÃÎÊĞÔºÃµÄ»ù´¡×é¼ş¡£
- **ºÃ´¦**:
  - **¿ª·¢Ğ§ÂÊ**: ÎŞĞè´ÓÁã±àĞ´¿¨Æ¬¡¢ÊäÈë¿ò¡¢°´Å¥µÈ×é¼ş£¬¿ÉÒÔÖ±½ÓÊ¹ÓÃ¡£
  - **Ò»ÖÂĞÔ**: ±£Ö¤ÁËÓ¦ÓÃ UI ·ç¸ñµÄÍ³Ò»¡£
  - **¿É¶¨ÖÆĞÔ**: ÒÀÈ»¿ÉÒÔÍ¨¹ı Tailwind CSS Àà½øĞĞÇáËÉµÄÑùÊ½¸²¸ÇºÍµ÷Õû£¬Èç´Ë´ÎÈÎÎñÖĞÖ±½ÓÎª°´Å¥Ö¸¶¨ g-blue-500¡£
- **×é¼şÊ¹ÓÃ**:
  - Card: ×÷ÎªµÇÂ¼±íµ¥µÄÈİÆ÷£¬Ìá¹©ÁËÇåÎúµÄÊÓ¾õ±ß½ç¡£
  - Input / Label: ¹¹½¨±ê×¼µÄ±íµ¥ÊäÈë×Ö¶Î¡£
  - Button: ÓÃÓÚÌá½»ºÍµÚÈı·½µÇÂ¼²Ù×÷¡£

#### 3. ÏìÓ¦Ê½Éè¼Æ
- **ÎªÊ²Ã´**: ÓÃ»§¿ÉÄÜÔÚ×ÀÃæ»òÒÆ¶¯Éè±¸ÉÏ·ÃÎÊµÇÂ¼Ò³Ãæ¡£
- **ÊµÏÖ**:
  - Ê¹ÓÃ min-h-screen ºÍ lex È·±£±íµ¥ÔÚ¸÷ÖÖÆÁÄ»³ß´çÏÂ¶¼ÄÜ´¹Ö±¾ÓÖĞ¡£
  - Card ×é¼şÉèÖÃÁË max-w-sm£¬È·±£ÔÚ¿íÆÁÉÏ²»»á¹ı·ÖÀ­Éì£¬Í¬Ê±ÔÚÒÆ¶¯Éè±¸ÉÏÄÜ×ÔÊÊÓ¦¿í¶È¡£

### ÓëÆäËûÎÄ¼şµÄ¹ØÁª

| ÎÄ¼ş | Ö°Ôğ | ¹ØÏµ |
|---|---|---|
| pp/(auth)/login/page.tsx | µÇÂ¼Ò³ÃæµÄ UI | - Ê¹ÓÃ components/ui/* ÖĞµÄ×é¼ş¹¹½¨½çÃæ¡£<br>- Á´½Óµ½ pp/(auth)/register/page.tsx¡£ |
| components/ui/button.tsx | °´Å¥×é¼ş | ÎªµÇÂ¼°´Å¥Ìá¹©»ù´¡ÑùÊ½ºÍĞĞÎª¡£ |
| components/ui/card.tsx | ¿¨Æ¬×é¼ş | ×÷ÎªµÇÂ¼±íµ¥µÄÊÓ¾õÈİÆ÷¡£ |
| pp/globals.css | È«¾ÖÑùÊ½ºÍÖ÷Ìâ±äÁ¿ | Ìá¹© shadcn/ui ×é¼şËùĞèµÄ»ù´¡ CSS ±äÁ¿£¨Èç --primary, --background µÈ£©¡£ |
| 	ailwind.config.ts | Tailwind ÅäÖÃ | ½« CSS ±äÁ¿£¨Èç hsl(var(--primary))£©Ó³Éäµ½ Tailwind µÄÑÕÉ«ÏµÍ³ÖĞ¡£ |

### ºóĞø²½Öè (²½Öè 2.5 & 2.6)
- µ±Ç°µÄµÇÂ¼Ò³ÃæÖ»ÊÇÒ»¸ö¾²Ì¬ UI¡£
- ÏÂÒ»²½½«Îª "ÓÊÏäµÇÂ¼" ºÍ "GitHub µÇÂ¼" °´Å¥Ìí¼Ó onClick ÊÂ¼ş´¦Àí³ÌĞò¡£
- ÕâĞ©´¦Àí³ÌĞò½«µ÷ÓÃ lib/supabase.ts ÖĞ´´½¨µÄ Supabase ¿Í»§¶ËµÄ signInWithPassword() ºÍ signInWithOAuth() ·½·¨£¬ÒÔÊµÏÖÕæÕıµÄÓÃ»§ÈÏÖ¤Âß¼­¡£

---

## æ­¥éª¤ 2.5 - å®ç°é‚®ç®±ç™»å½•åŠŸèƒ½ä¸ä»ªè¡¨æ¿

### å®ç°ç›®æ ‡
å®ç°ç”¨æˆ·é‚®ç®±å’Œå¯†ç ç™»å½•çš„å®Œæ•´æµç¨‹ï¼ŒåŒ…æ‹¬è¡¨å•å¤„ç†ã€Supabase è®¤è¯é›†æˆã€é”™è¯¯å¤„ç†ã€ä¼šè¯ç®¡ç†å’Œé‡å®šå‘é€»è¾‘ã€‚åŒæ—¶åˆ›å»ºå—ä¿æŠ¤çš„ä»ªè¡¨æ¿è·¯ç”±ï¼Œç¡®ä¿åªæœ‰å·²è®¤è¯çš„ç”¨æˆ·å¯ä»¥è®¿é—®ã€‚

### æ–°å¢æ–‡ä»¶ç»“æ„

#### 1. å‰ç«¯è·¯ç”±ä¸ç»„ä»¶

```
app/
â”œâ”€â”€ (auth)/
â”‚   â””â”€â”€ login/
â”‚       â””â”€â”€ page.tsx                  # âœ¨ å¢å¼ºçš„ç™»å½•é¡µé¢ï¼ˆæ”¯æŒé‚®ç®±/å¯†ç +GitHub OAuthï¼‰
â”œâ”€â”€ (dashboard)/                      # âœ¨ æ–°å¢ï¼šå—ä¿æŠ¤çš„è·¯ç”±åˆ†ç»„
â”‚   â”œâ”€â”€ layout.tsx                    # âœ¨ æ–°å¢ï¼šä»ªè¡¨æ¿å¸ƒå±€ä¸è®¤è¯æ£€æŸ¥
â”‚   â””â”€â”€ dashboard/
â”‚       â””â”€â”€ page.tsx                  # âœ¨ æ–°å¢ï¼šä»ªè¡¨æ¿é¦–é¡µ
components/ui/
â”œâ”€â”€ button.tsx                        # å·²æœ‰
â”œâ”€â”€ card.tsx                          # å·²æœ‰
â”œâ”€â”€ input.tsx                         # å·²æœ‰
â”œâ”€â”€ label.tsx                         # å·²æœ‰
â”œâ”€â”€ progress.tsx                      # å·²æœ‰
â”œâ”€â”€ alert-dialog.tsx                  # å·²æœ‰
â””â”€â”€ alert.tsx                         # âœ¨ æ–°å¢ï¼šé”™è¯¯æç¤ºç»„ä»¶
```

### æ ¸å¿ƒæ¶æ„ä¸è®¾è®¡æ¨¡å¼

#### 1. è®¤è¯æµç¨‹è®¾è®¡

**é‚®ç®±ç™»å½•æµç¨‹**:
```
ç”¨æˆ·è¾“å…¥é‚®ç®±+å¯†ç 
      â†“
handleEmailLogin å‡½æ•°è§¦å‘
      â†“
supabase.auth.signInWithPassword()
      â†“
Supabase æœåŠ¡ç«¯éªŒè¯
      â”œâ”€ æˆåŠŸ â†’ è¿”å› user å¯¹è±¡å’Œ session token
      â”œâ”€ å¤±è´¥ â†’ è¿”å› error å¯¹è±¡
      â†“
å‰ç«¯åˆ¤æ–­ç»“æœ
      â”œâ”€ æˆåŠŸ â†’ useRouter().push("/dashboard")
      â””â”€ å¤±è´¥ â†’ åœ¨ Alert æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
```

**GitHub OAuth æµç¨‹**:
```
ç”¨æˆ·ç‚¹å‡» "GitHub ç™»å½•"
      â†“
handleGitHubLogin å‡½æ•°è§¦å‘
      â†“
supabase.auth.signInWithOAuth({provider: 'github'})
      â†“
é‡å®šå‘åˆ° GitHub æˆæƒé¡µé¢
      â†“
ç”¨æˆ·æˆæƒå
      â†“
GitHub é‡å®šå‘å›åº”ç”¨ï¼ˆå¸¦ auth codeï¼‰
      â†“
Supabase ä½¿ç”¨ code äº¤æ¢ token
      â†“
è‡ªåŠ¨é‡å®šå‘åˆ° /dashboard
```

#### 2. ä¼šè¯ç®¡ç†ä¸çŠ¶æ€åŒæ­¥

**Initial Session Check** (åœ¨ Dashboard Layout ä¸­):
```typescript
useEffect(() => {
  const checkAuth = async () => {
    const { data, error } = await supabase.auth.getSession();
    
    if (!data?.session?.user) {
      router.push("/login");  // æœªè®¤è¯â†’é‡å®šå‘ç™»å½•
    } else {
      setUser(data.session.user);  // ä¿å­˜ç”¨æˆ·ä¿¡æ¯
    }
  };
  
  checkAuth();
}, []);
```

**Continuous Monitoring** (è®¢é˜…è®¤è¯å˜åŒ–):
```typescript
const { data: { subscription } } = supabase.auth.onAuthStateChange((event, session) => {
  if (!session?.user) {
    router.push("/login");  // ä¼šè¯å¤±æ•ˆâ†’é‡å®šå‘
  } else {
    setUser(session.user);  // æ›´æ–°ç”¨æˆ·çŠ¶æ€
  }
});
```

**ä¼˜åŠ¿**:
- è‡ªåŠ¨å¤„ç† token åˆ·æ–°
- å®æ—¶å“åº”è®¤è¯çŠ¶æ€å˜åŒ–
- æµè§ˆå™¨æ ‡ç­¾åŒæ­¥ï¼ˆä¸€ä¸ªæ ‡ç­¾ç™»å‡ºï¼Œå…¶ä»–æ ‡ç­¾è‡ªåŠ¨æ£€æµ‹ï¼‰

#### 3. é”™è¯¯å¤„ç†ä¸ç”¨æˆ·åé¦ˆ

**ä¸‰å±‚é”™è¯¯å¤„ç†**:
```typescript
// ç¬¬ 1 å±‚ï¼šè¾“å…¥éªŒè¯ï¼ˆå‰ç«¯ï¼‰
if (!email || !password) {
  setError("é‚®ç®±å’Œå¯†ç ä¸èƒ½ä¸ºç©º");
  return;
}

// ç¬¬ 2 å±‚ï¼šAPI é”™è¯¯ï¼ˆSupabase è¿”å›ï¼‰
const { error: signInError } = await supabase.auth.signInWithPassword(...);
if (signInError) {
  setError(signInError.message || "é‚®ç®±æˆ–å¯†ç é”™è¯¯");
  return;
}

// ç¬¬ 3 å±‚ï¼šç½‘ç»œ/æœªçŸ¥é”™è¯¯ï¼ˆtry-catchï¼‰
try {
  // ...
} catch (err) {
  setError("ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•");
  console.error("Login error:", err);
}
```

**ç”¨æˆ·åé¦ˆæœºåˆ¶**:
- âœ… åŠ è½½çŠ¶æ€ï¼šæŒ‰é’®æ˜¾ç¤º "ç™»å½•ä¸­..."ã€"å¤„ç†ä¸­..."
- âœ… é”™è¯¯æç¤ºï¼šAlert ç»„ä»¶æ˜¾ç¤ºçº¢è‰²é”™è¯¯æ¶ˆæ¯
- âœ… ç¦ç”¨è¾“å…¥ï¼šç™»å½•è¿‡ç¨‹ä¸­è¾“å…¥æ¡†ç¦ç”¨ï¼Œé˜²æ­¢é‡å¤æäº¤
- âœ… è‡ªåŠ¨é‡å®šå‘ï¼šæˆåŠŸåè‡ªåŠ¨è·³è½¬åˆ°é¦–é¡µ

#### 4. è·¯ç”±ä¿æŠ¤ä¸åˆ†ç»„

**Route Groups çš„ç”¨é€”**:
```
(auth) åˆ†ç»„      â†’ å…¬å¼€è·¯ç”±ï¼ˆç™»å½•ã€æ³¨å†Œï¼‰
      â†“
  page.tsx ä¸­æ— è®¤è¯æ£€æŸ¥
  å…è®¸æœªç™»å½•ç”¨æˆ·è®¿é—®
  
(dashboard) åˆ†ç»„ â†’ å—ä¿æŠ¤çš„è·¯ç”±ï¼ˆé¦–é¡µã€åˆ·é¢˜ã€é”™é¢˜æœ¬ï¼‰
      â†“
  layout.tsx ä¸­æœ‰è®¤è¯æ£€æŸ¥
  æœªç™»å½•ç”¨æˆ·è‡ªåŠ¨é‡å®šå‘åˆ° /login
```

**Benefits**:
- URL ä¸åŒ…å«æ‹¬å·ï¼ˆ/login vs /(auth)/loginï¼‰
- é€»è¾‘åˆ†ç»„æ¸…æ™°ï¼Œä¾¿äºä»£ç ç»„ç»‡
- ä¸åŒè·¯ç”±ç»„å¯ä½¿ç”¨ä¸åŒçš„ layout

#### 5. ä»ªè¡¨æ¿é¡µé¢è®¾è®¡

**Dashboard Layout** (`(dashboard)/layout.tsx`):
- æ‰€æœ‰ä»ªè¡¨æ¿é¡µé¢å…±ç”¨æ­¤ layout
- åœ¨æ­¤æ£€æŸ¥è®¤è¯çŠ¶æ€ï¼ˆä¸€æ¬¡æ€§ï¼Œè€Œéæ¯ä¸ªé¡µé¢é‡å¤ï¼‰
- æä¾›ç»Ÿä¸€çš„å¯¼èˆªæ å’Œèœå•
- åŒ…å«ç™»å‡ºåŠŸèƒ½

**Dashboard Home** (`dashboard/page.tsx`):
- æ˜¾ç¤ºç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼ˆç”¨æˆ·åã€ç­‰çº§ã€XPã€æ‰“å¡å¤©æ•°ï¼‰
- æ˜¾ç¤ºå¿«é€Ÿå¼€å§‹æŒ‰é’®ï¼ˆæŒ‡å‘åˆ·é¢˜ã€é”™é¢˜æœ¬ã€ç•ªèŒ„é’Ÿï¼‰
- æ˜¾ç¤ºä»Šæ—¥å­¦ä¹ æ¦‚è§ˆï¼ˆåšé¢˜æ•°ã€æ­£ç¡®ç‡ã€ç•ªèŒ„æ•°ã€é”™é¢˜æ•°ï¼‰
- ä» profiles è¡¨åŠ è½½ç”¨æˆ·æ•°æ®

### å…³é”®æŠ€æœ¯ç‚¹

#### 1. React Hooks çš„åº”ç”¨

| Hook | ç”¨é€” | ç¤ºä¾‹ |
|------|------|------|
| `useState` | ç®¡ç†è¡¨å•çŠ¶æ€å’Œ UI çŠ¶æ€ | `[email, setEmail]`ã€`[isLoading, setIsLoading]` |
| `useRouter` | å®¢æˆ·ç«¯è·¯ç”±è·³è½¬ | `router.push("/dashboard")` |
| `useEffect` | åˆå§‹åŒ–æ—¶æ£€æŸ¥è®¤è¯ï¼Œè®¢é˜…è®¤è¯å˜åŒ– | åœ¨ layout ä¸­ç›‘å¬ä¼šè¯å˜åŒ– |

#### 2. Supabase Auth çš„é‡è¦æ–¹æ³•

| æ–¹æ³• | åŠŸèƒ½ | è¿”å›å€¼ |
|------|------|--------|
| `signInWithPassword()` | é‚®ç®±+å¯†ç ç™»å½• | `{data: {user, session}, error}` |
| `signInWithOAuth()` | OAuth ç™»å½•ï¼ˆGitHubã€Google ç­‰ï¼‰ | é‡å®šå‘åˆ°ç¬¬ä¸‰æ–¹ |
| `getSession()` | è·å–å½“å‰ä¼šè¯ | `{data: {session}, error}` |
| `onAuthStateChange()` | è®¢é˜…è®¤è¯çŠ¶æ€å˜åŒ– | è¿”å› subscription å¯¹è±¡ |
| `signOut()` | ç™»å‡ºç”¨æˆ· | `{error}` |

#### 3. TypeScript ç±»å‹å®‰å…¨

**Supabase è¿”å›çš„ç”¨æˆ·å¯¹è±¡**:
```typescript
interface AuthUser {
  id: string;
  email: string;
  user_metadata?: Record<string, any>;
  // ... å…¶ä»–å­—æ®µ
}
```

**ç±»å‹æ£€æŸ¥çš„å¥½å¤„**:
- IDE è‡ªåŠ¨è¡¥å…¨
- ç¼–è¯‘æ—¶æ•è·é”™è¯¯ï¼ˆå¦‚ `user?.email` çš„ç±»å‹æ˜¯ string | nullï¼Œéœ€è¦å¤„ç† nullï¼‰
- ä»£ç æ–‡æ¡£ä½œç”¨ï¼ˆæ–¹ä¾¿ç†è§£æ•°æ®ç»“æ„ï¼‰

#### 4. çŠ¶æ€ç®¡ç†æµç¨‹

```
Login Page:
  â”œâ”€ email: ç”¨æˆ·è¾“å…¥çš„é‚®ç®±
  â”œâ”€ password: ç”¨æˆ·è¾“å…¥çš„å¯†ç 
  â”œâ”€ isLoading: æ˜¯å¦ç™»å½•ä¸­
  â””â”€ error: é”™è¯¯ä¿¡æ¯

Dashboard Layout:
  â”œâ”€ user: å½“å‰ç™»å½•ç”¨æˆ·ï¼ˆä» Supabase è·å–ï¼‰
  â”œâ”€ email: ç”¨æˆ·é‚®ç®±ï¼ˆå±•ç¤ºåœ¨å¯¼èˆªæ ï¼‰
  â”œâ”€ isLoading: æ˜¯å¦æ­£åœ¨æ£€æŸ¥è®¤è¯
  â””â”€ è®¢é˜… auth state å˜åŒ–

Dashboard Page:
  â”œâ”€ profile: ç”¨æˆ· profiles è¡¨æ•°æ®
  â”œâ”€ isLoading: æ˜¯å¦æ­£åœ¨åŠ è½½æ•°æ®
  â””â”€ error: æ•°æ®åŠ è½½é”™è¯¯
```

### å®‰å…¨æ€§è€ƒè™‘

#### 1. å¯†ç å®‰å…¨
- âœ… å¯†ç æ°¸ä¸åœ¨å‰ç«¯å­˜å‚¨ä¸ºæ˜æ–‡
- âœ… å¯†ç é€šè¿‡ HTTPS ä¼ è¾“åˆ° Supabase
- âœ… Supabase ä½¿ç”¨ bcrypt åŠ å¯†å­˜å‚¨å¯†ç 
- âœ… å®¢æˆ·ç«¯æ°¸ä¸æœ‰æƒè®¿é—®å¯†ç å“ˆå¸Œ

#### 2. Session Token å®‰å…¨
- âœ… ç™»å½•æˆåŠŸåï¼ŒSupabase è¿”å› JWT token
- âœ… Token è‡ªåŠ¨ä¿å­˜åœ¨æµè§ˆå™¨çš„ localStorage/cookies
- âœ… åç»­è¯·æ±‚è‡ªåŠ¨æºå¸¦ tokenï¼ˆSupabase SDK è‡ªåŠ¨å¤„ç†ï¼‰
- âœ… Token æœ‰è¿‡æœŸæ—¶é—´ï¼Œè¿‡æœŸæ—¶è‡ªåŠ¨åˆ·æ–°
- âœ… logout æ—¶ token è¢«æ¸…é™¤

#### 3. RLS (Row Level Security)
- âœ… profiles è¡¨å¯ç”¨ RLSï¼Œç¡®ä¿ç”¨æˆ·åªèƒ½è¯»å–å…¨è¡¨ä½†åªèƒ½ä¿®æ”¹è‡ªå·±çš„è®°å½•
- âœ… å³ä½¿å‰ç«¯æœ‰ bugï¼Œæ•°æ®åº“ä¹Ÿä¼šåœ¨æœåŠ¡ç«¯è¿›è¡Œæƒé™æ£€æŸ¥

### æ€§èƒ½ä¼˜åŒ–

#### 1. Code Splitting
- Login é¡µé¢å’Œ Dashboard æ˜¯åˆ†å¼€çš„é¡µé¢ï¼Œä¸ä¼šäº’ç›¸å½±å“åŠ è½½æ—¶é—´
- Layout ä¸­ä½¿ç”¨ `useEffect` è¿›è¡Œå¼‚æ­¥è®¤è¯æ£€æŸ¥ï¼Œä¸é˜»å¡é¦–å±æ¸²æŸ“

#### 2. ç¼“å­˜ç­–ç•¥
- Supabase SDK è‡ªåŠ¨ç¼“å­˜ sessionï¼ˆæ— éœ€æ¯æ¬¡éƒ½è¯·æ±‚ï¼‰
- `onAuthStateChange` è®¢é˜…ç¡®ä¿è®¤è¯çŠ¶æ€åŒæ­¥ï¼Œä½†ä¸ä¼šé¢‘ç¹è¯·æ±‚

### åç»­æ‰©å±•ç‚¹

#### 1. é‚®ç®±éªŒè¯
- å½“å‰å®ç°ï¼šç”¨æˆ·å¯ç›´æ¥ç™»å½•
- è®¡åˆ’ï¼šå‘é€éªŒè¯é‚®ä»¶ï¼Œç”¨æˆ·éªŒè¯åæ‰èƒ½ä½¿ç”¨

#### 2. å¯†ç é‡ç½®
- å½“å‰å®ç°ï¼šæ— å¯†ç é‡ç½®åŠŸèƒ½
- è®¡åˆ’ï¼šæä¾›"å¿˜è®°å¯†ç "é“¾æ¥ï¼Œç”¨æˆ·é€šè¿‡é‚®ä»¶é‡ç½®

#### 3. æ›´å¤š OAuth æä¾›å•†
- å½“å‰å®ç°ï¼šGitHub OAuth
- è®¡åˆ’ï¼šGoogleã€å¾®ä¿¡ã€ä¼ä¸š SSO ç­‰

#### 4. å¤šå› ç´ è®¤è¯ (MFA)
- å½“å‰å®ç°ï¼šä»…é‚®ç®±+å¯†ç 
- è®¡åˆ’ï¼šæ”¯æŒçŸ­ä¿¡ã€Google Authenticator ç­‰

### æ–‡ä»¶èŒè´£æ€»ç»“

| æ–‡ä»¶ | èŒè´£ | è°ƒç”¨å…³ç³» |
|------|------|---------|
| `app/(auth)/login/page.tsx` | é‚®ç®±/å¯†ç è¡¨å•å’Œ GitHub OAuth æŒ‰é’® | â† ç”¨æˆ·ç‚¹å‡»<br>â†’ Supabase Auth |
| `app/(dashboard)/layout.tsx` | è®¤è¯æ£€æŸ¥ã€å¯¼èˆªæ ã€ç™»å‡º | â† æ‰€æœ‰ dashboard/* é¡µé¢<br>â†’ Supabase Authã€useRouter |
| `app/(dashboard)/dashboard/page.tsx` | æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯å’Œä»Šæ—¥ç»Ÿè®¡ | â† Dashboard Layout<br>â†’ Supabase DB (profiles) |
| `components/ui/alert.tsx` | æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ | â† Login Pageã€Dashboard Page |
| `lib/supabase.ts` | Supabase å®¢æˆ·ç«¯å®ä¾‹ | â† Loginã€Layoutã€Dashboard é¡µé¢ |
| `lib/types.ts` | TypeScript æ•°æ®ç±»å‹å®šä¹‰ | â† æ‰€æœ‰ä½¿ç”¨ DB æ•°æ®çš„æ–‡ä»¶ |

---
